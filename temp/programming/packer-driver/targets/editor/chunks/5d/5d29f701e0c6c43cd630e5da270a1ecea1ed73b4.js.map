{"version":3,"sources":["file:///E:/work_space/wx/Cat_Journey/assets/scripts/gameplay/EnhancedBrick.ts"],"names":["_decorator","Component","Collider2D","Contact2DType","Color","Sprite","tween","Vec3","Prefab","instantiate","RigidBody2D","Vec2","Enum","GameManager","RelicManager","ccclass","property","BrickType","EnhancedBrick","type","_maxHealth","_sprite","_originalColor","_lastHitTime","_isElectric","_isShielded","_regenerationTimer","onLoad","health","getComponent","color","clone","collider","on","BEGIN_CONTACT","onBeginContact","initializeBrickType","update","dt","brickType","REGENERATING","Math","min","regenerationRate","updateVisualState","updateTimeBasedEffects","NORMAL","setBrickColor","RED","REINFORCED","BLUE","scoreValue","EXPLOSIVE","YELLOW","ELECTRIC","EXPERIENCE","GREEN","experienceValue","PHASE","MAGNETIC","REFLECTIVE","POISON","ICE","FIRE","SPLITTING","TELEPORT","SHIELD","GRAVITY","TIME","HEALING","CURSED","CRYSTAL","RUBBER","METAL","VOID","LIGHT","DARK","selfCollider","otherCollider","contact","ball","random","phaseProbability","console","log","showPhaseEffect","showShieldEffect","applyPreHitEffects","takeDamage","node","getWorldPosition","ballCollider","applyMagneticEffect","applyIceEffect","applyFireEffect","applyGravityEffect","applyTimeEffect","damage","impactPosition","onDestroyed","showDamageEffect","gameManager","getInstance","relicManager","applyDestructionEffects","hasRelic","explodeAdjacent","brickPosition","dropsExperience","onBrickDestroyed","destroy","createExplosion","triggerElectricChain","createSplitBricks","teleportBall","healPaddle","applyCurse","triggerCrystalChain","consumeBall","center","allBricks","parent","getComponentsInChildren","brick","distance","explosionRadius","max","floor","showExplosionEffect","nearbyBricks","findNearbyBricks","electricChainDistance","showElectricEffect","ballRigidBody","direction","subtract","normalize","force","multiplyScalar","x","y","magneticForce","applyForceToCenter","setSpeedMultiplier","paddle","getComponentInChildren","instantRepair","dropExperienceOrb","experienceOrbPrefab","orb","setParent","setWorldPosition","radius","nearby","push","healthRatio","currentColor","r","g","b","sparkleEffect","pulseEffect","to","WHITE","start","TRANSPARENT","CYAN","currentHealth","maxHealth","isDestroyed","setShielded","shielded"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Collider2D, Contact2DType, IPhysics2DContact, Color, Sprite, tween, Vec3, Prefab, instantiate, RigidBody2D, Vec2, Enum } from 'cc';\r\nimport { GameManager } from './GameManager';\r\nimport { RelicManager } from '../managers/RelicManager';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum BrickType {\r\n    NORMAL = 0,\r\n    REINFORCED = 1,        // 需要多次击打\r\n    EXPLOSIVE = 2,         // 爆炸砖块\r\n    ELECTRIC = 3,          // 导电砖块\r\n    EXPERIENCE = 4,        // 经验砖块\r\n    REGENERATING = 5,      // 自我修复砖块\r\n    PHASE = 6,            // 相位砖块(有时穿透)\r\n    MAGNETIC = 7,          // 磁性砖块(吸引球)\r\n    REFLECTIVE = 8,        // 反射砖块(改变球方向)\r\n    POISON = 9,           // 毒性砖块(持续伤害)\r\n    ICE = 10,             // 冰冻砖块(减慢球速)\r\n    FIRE = 11,            // 火焰砖块(加速球)\r\n    SPLITTING = 12,       // 分裂砖块(分裂成多个)\r\n    TELEPORT = 13,        // 传送砖块(球随机传送)\r\n    SHIELD = 14,          // 护盾砖块(保护周围砖块)\r\n    GRAVITY = 15,         // 重力砖块(改变重力)\r\n    TIME = 16,            // 时间砖块(减慢/加速时间)\r\n    HEALING = 17,         // 治疗砖块(修复挡板)\r\n    CURSED = 18,          // 诅咒砖块(负面效果)\r\n    CRYSTAL = 19,         // 水晶砖块(连锁反应)\r\n    RUBBER = 20,          // 橡胶砖块(超强反弹)\r\n    METAL = 21,           // 金属砖块(反弹伤害)\r\n    VOID = 22,            // 虚空砖块(吞噬球)\r\n    LIGHT = 23,           // 光明砖块(照亮区域)\r\n    DARK = 24             // 黑暗砖块(减少视野)\r\n}\r\n\r\n@ccclass('EnhancedBrick')\r\nexport class EnhancedBrick extends Component {\r\n    @property({type: Enum(BrickType)})\r\n    public brickType: BrickType = BrickType.NORMAL;\r\n    \r\n    @property\r\n    public health: number = 1;\r\n    \r\n    @property  \r\n    public scoreValue: number = 10;\r\n    \r\n    @property\r\n    public experienceValue: number = 5;\r\n    \r\n    @property({type: Prefab})\r\n    public experienceOrbPrefab: Prefab | null = null;\r\n    \r\n    // Type-specific properties\r\n    @property\r\n    public explosionRadius: number = 100;\r\n    \r\n    @property\r\n    public electricChainDistance: number = 80;\r\n    \r\n    @property\r\n    public magneticForce: number = 300;\r\n    \r\n    @property\r\n    public regenerationRate: number = 0.1; // Health per second\r\n    \r\n    @property\r\n    public phaseProbability: number = 0.3; // 30% chance to phase\r\n    \r\n    private _maxHealth: number = 0;\r\n    private _sprite: Sprite | null = null;\r\n    private _originalColor: Color = new Color();\r\n    private _lastHitTime: number = 0;\r\n    private _isElectric: boolean = false;\r\n    private _isShielded: boolean = false;\r\n    private _regenerationTimer: number = 0;\r\n    \r\n    protected onLoad(): void {\r\n        this._maxHealth = this.health;\r\n        this._sprite = this.getComponent(Sprite);\r\n        \r\n        if (this._sprite) {\r\n            this._originalColor = this._sprite.color.clone();\r\n        }\r\n        \r\n        const collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n        \r\n        this.initializeBrickType();\r\n    }\r\n    \r\n    protected update(dt: number): void {\r\n        this._lastHitTime += dt;\r\n        \r\n        // Handle regenerating bricks\r\n        if (this.brickType === BrickType.REGENERATING && this.health < this._maxHealth) {\r\n            this._regenerationTimer += dt;\r\n            if (this._regenerationTimer >= 1.0) {\r\n                this.health = Math.min(this._maxHealth, this.health + this.regenerationRate);\r\n                this.updateVisualState();\r\n                this._regenerationTimer = 0;\r\n            }\r\n        }\r\n        \r\n        // Handle time-based effects\r\n        this.updateTimeBasedEffects(dt);\r\n    }\r\n    \r\n    public initializeBrickType(): void {\r\n        switch (this.brickType) {\r\n            case BrickType.NORMAL:\r\n                this.setBrickColor(Color.RED);\r\n                break;\r\n            case BrickType.REINFORCED:\r\n                this.health = 3;\r\n                this._maxHealth = 3;\r\n                this.setBrickColor(Color.BLUE);\r\n                this.scoreValue = 30;\r\n                break;\r\n            case BrickType.EXPLOSIVE:\r\n                this.setBrickColor(Color.YELLOW);\r\n                this.scoreValue = 25;\r\n                break;\r\n            case BrickType.ELECTRIC:\r\n                this.setBrickColor(new Color(0, 255, 255)); // Cyan\r\n                this.scoreValue = 20;\r\n                break;\r\n            case BrickType.EXPERIENCE:\r\n                this.setBrickColor(Color.GREEN);\r\n                this.experienceValue = 20;\r\n                break;\r\n            case BrickType.REGENERATING:\r\n                this.health = 2;\r\n                this._maxHealth = 2;\r\n                this.setBrickColor(new Color(255, 0, 255)); // Magenta\r\n                break;\r\n            case BrickType.PHASE:\r\n                this.setBrickColor(new Color(128, 128, 255)); // Light blue\r\n                break;\r\n            case BrickType.MAGNETIC:\r\n                this.setBrickColor(new Color(128, 0, 128)); // Purple\r\n                break;\r\n            case BrickType.REFLECTIVE:\r\n                this.setBrickColor(new Color(255, 215, 0)); // Gold\r\n                this.scoreValue = 15;\r\n                break;\r\n            case BrickType.POISON:\r\n                this.setBrickColor(new Color(128, 255, 0)); // Lime green\r\n                this.scoreValue = 18;\r\n                break;\r\n            case BrickType.ICE:\r\n                this.setBrickColor(new Color(200, 255, 255)); // Light cyan\r\n                break;\r\n            case BrickType.FIRE:\r\n                this.setBrickColor(new Color(255, 100, 0)); // Orange\r\n                break;\r\n            case BrickType.SPLITTING:\r\n                this.setBrickColor(new Color(255, 182, 193)); // Light pink\r\n                this.scoreValue = 22;\r\n                break;\r\n            case BrickType.TELEPORT:\r\n                this.setBrickColor(new Color(138, 43, 226)); // Blue violet\r\n                this.scoreValue = 35;\r\n                break;\r\n            case BrickType.SHIELD:\r\n                this.setBrickColor(new Color(192, 192, 192)); // Silver\r\n                this.health = 2;\r\n                this._maxHealth = 2;\r\n                this.scoreValue = 40;\r\n                break;\r\n            case BrickType.GRAVITY:\r\n                this.setBrickColor(new Color(75, 0, 130)); // Indigo\r\n                this.scoreValue = 50;\r\n                break;\r\n            case BrickType.TIME:\r\n                this.setBrickColor(new Color(255, 20, 147)); // Deep pink\r\n                this.scoreValue = 45;\r\n                break;\r\n            case BrickType.HEALING:\r\n                this.setBrickColor(new Color(144, 238, 144)); // Light green\r\n                this.scoreValue = 12;\r\n                break;\r\n            case BrickType.CURSED:\r\n                this.setBrickColor(new Color(128, 0, 0)); // Maroon\r\n                this.scoreValue = 5;\r\n                break;\r\n            case BrickType.CRYSTAL:\r\n                this.setBrickColor(new Color(230, 230, 250)); // Lavender\r\n                this.scoreValue = 30;\r\n                break;\r\n            case BrickType.RUBBER:\r\n                this.setBrickColor(new Color(255, 105, 180)); // Hot pink\r\n                this.scoreValue = 8;\r\n                break;\r\n            case BrickType.METAL:\r\n                this.health = 4;\r\n                this._maxHealth = 4;\r\n                this.setBrickColor(new Color(169, 169, 169)); // Dark gray\r\n                this.scoreValue = 50;\r\n                break;\r\n            case BrickType.VOID:\r\n                this.setBrickColor(new Color(25, 25, 112)); // Midnight blue\r\n                this.scoreValue = 100;\r\n                break;\r\n            case BrickType.LIGHT:\r\n                this.setBrickColor(new Color(255, 255, 224)); // Light yellow\r\n                this.scoreValue = 15;\r\n                break;\r\n            case BrickType.DARK:\r\n                this.setBrickColor(new Color(47, 79, 79)); // Dark slate gray\r\n                this.scoreValue = 25;\r\n                break;\r\n        }\r\n    }\r\n    \r\n    private setBrickColor(color: Color): void {\r\n        if (this._sprite) {\r\n            this._sprite.color = color;\r\n            this._originalColor = color.clone();\r\n        }\r\n    }\r\n    \r\n    private onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null): void {\r\n        const ball = otherCollider.getComponent('Ball');\r\n        if (!ball) return;\r\n        \r\n        // Handle phase bricks\r\n        if (this.brickType === BrickType.PHASE && Math.random() < this.phaseProbability) {\r\n            console.log('Ball phased through brick!');\r\n            this.showPhaseEffect();\r\n            return; // Ball passes through\r\n        }\r\n        \r\n        // Handle shielded bricks\r\n        if (this._isShielded) {\r\n            console.log('Attack blocked by shield!');\r\n            this.showShieldEffect();\r\n            return;\r\n        }\r\n        \r\n        // Apply brick-specific pre-hit effects\r\n        this.applyPreHitEffects(ball, otherCollider);\r\n        \r\n        // Take damage\r\n        this.takeDamage(1, otherCollider.node.getWorldPosition());\r\n    }\r\n    \r\n    private applyPreHitEffects(ball: any, ballCollider: Collider2D): void {\r\n        switch (this.brickType) {\r\n            case BrickType.MAGNETIC:\r\n                this.applyMagneticEffect(ballCollider);\r\n                break;\r\n            case BrickType.ICE:\r\n                this.applyIceEffect(ball);\r\n                break;\r\n            case BrickType.FIRE:\r\n                this.applyFireEffect(ball);\r\n                break;\r\n            case BrickType.GRAVITY:\r\n                this.applyGravityEffect();\r\n                break;\r\n            case BrickType.TIME:\r\n                this.applyTimeEffect();\r\n                break;\r\n        }\r\n    }\r\n    \r\n    public takeDamage(damage: number, impactPosition?: Vec3): void {\r\n        this.health -= damage;\r\n        this._lastHitTime = 0;\r\n        \r\n        if (this.health <= 0) {\r\n            this.onDestroyed(impactPosition);\r\n        } else {\r\n            this.showDamageEffect();\r\n            this.updateVisualState();\r\n        }\r\n    }\r\n    \r\n    private onDestroyed(impactPosition?: Vec3): void {\r\n        const gameManager = GameManager.getInstance();\r\n        const relicManager = RelicManager.getInstance();\r\n        \r\n        // Apply post-destruction effects before notifying GameManager\r\n        this.applyDestructionEffects(impactPosition);\r\n        \r\n        // Check for explosive bricks relic\r\n        if (relicManager && (relicManager as any).hasRelic) {\r\n            (relicManager as any).hasRelic('ExplosiveBricks');\r\n            this.explodeAdjacent(impactPosition);\r\n        }\r\n        \r\n        // Notify GameManager (handles score, level completion, power-ups)\r\n        const brickPosition = this.node.getWorldPosition();\r\n        const dropsExperience = this.brickType === BrickType.EXPERIENCE || Math.random() < 0.3;\r\n        \r\n        if (gameManager) {\r\n            gameManager.onBrickDestroyed(this.scoreValue, brickPosition, dropsExperience);\r\n        }\r\n        \r\n        // Destroy the brick\r\n        this.node.destroy();\r\n    }\r\n    \r\n    private applyDestructionEffects(impactPosition?: Vec3): void {\r\n        switch (this.brickType) {\r\n            case BrickType.EXPLOSIVE:\r\n                this.createExplosion(impactPosition);\r\n                break;\r\n            case BrickType.ELECTRIC:\r\n                this.triggerElectricChain();\r\n                break;\r\n            case BrickType.SPLITTING:\r\n                this.createSplitBricks();\r\n                break;\r\n            case BrickType.TELEPORT:\r\n                this.teleportBall();\r\n                break;\r\n            case BrickType.HEALING:\r\n                this.healPaddle();\r\n                break;\r\n            case BrickType.CURSED:\r\n                this.applyCurse();\r\n                break;\r\n            case BrickType.CRYSTAL:\r\n                this.triggerCrystalChain();\r\n                break;\r\n            case BrickType.VOID:\r\n                this.consumeBall();\r\n                break;\r\n        }\r\n    }\r\n    \r\n    private createExplosion(center?: Vec3): void {\r\n        if (!center) center = this.node.getWorldPosition();\r\n        \r\n        // Find all bricks within explosion radius\r\n        const allBricks = this.node.parent?.getComponentsInChildren(EnhancedBrick) || [];\r\n        \r\n        for (const brick of allBricks) {\r\n            if (brick === this) continue;\r\n            \r\n            const distance = Vec3.distance(center, brick.node.getWorldPosition());\r\n            if (distance <= this.explosionRadius) {\r\n                // Damage decreases with distance\r\n                const damage = Math.max(1, Math.floor(3 * (1 - distance / this.explosionRadius)));\r\n                brick.takeDamage(damage);\r\n                brick.showExplosionEffect();\r\n            }\r\n        }\r\n        \r\n        console.log(`Explosion at ${center} with radius ${this.explosionRadius}`);\r\n    }\r\n    \r\n    private triggerElectricChain(): void {\r\n        const nearbyBricks = this.findNearbyBricks(this.electricChainDistance);\r\n        \r\n        for (const brick of nearbyBricks) {\r\n            if (brick.brickType === BrickType.ELECTRIC || brick._isElectric) {\r\n                brick._isElectric = true;\r\n                brick.takeDamage(1);\r\n                brick.showElectricEffect();\r\n            }\r\n        }\r\n    }\r\n    \r\n    private applyMagneticEffect(ballCollider: Collider2D): void {\r\n        const ballRigidBody = ballCollider.getComponent(RigidBody2D);\r\n        if (!ballRigidBody) return;\r\n        \r\n        const direction = Vec3.subtract(new Vec3(), this.node.getWorldPosition(), ballCollider.node.getWorldPosition()).normalize();\r\n        const force = Vec2.multiplyScalar(new Vec2(), new Vec2(direction.x, direction.y), this.magneticForce);\r\n        \r\n        ballRigidBody.applyForceToCenter(force, true);\r\n        console.log('Magnetic force applied to ball');\r\n    }\r\n    \r\n    private applyIceEffect(ball: any): void {\r\n        // Slow down the ball temporarily\r\n        if (ball && ball.setSpeedMultiplier) {\r\n            ball.setSpeedMultiplier(0.5, 3.0); // 50% speed for 3 seconds\r\n            console.log('Ball slowed by ice brick');\r\n        }\r\n    }\r\n    \r\n    private applyFireEffect(ball: any): void {\r\n        // Speed up the ball temporarily  \r\n        if (ball && ball.setSpeedMultiplier) {\r\n            ball.setSpeedMultiplier(1.5, 3.0); // 150% speed for 3 seconds\r\n            console.log('Ball accelerated by fire brick');\r\n        }\r\n    }\r\n    \r\n    private healPaddle(): void {\r\n        const paddle = this.node.parent?.getComponentInChildren('EnhancedPaddleController') as any;\r\n        if (paddle && paddle.instantRepair) {\r\n            paddle.instantRepair(25);\r\n            console.log('Paddle healed by healing brick');\r\n        }\r\n    }\r\n    \r\n    private dropExperienceOrb(): void {\r\n        if (!this.experienceOrbPrefab) return;\r\n        \r\n        const orb = instantiate(this.experienceOrbPrefab);\r\n        orb.setParent(this.node.parent);\r\n        orb.setWorldPosition(this.node.getWorldPosition());\r\n        \r\n        console.log(`Dropped experience orb worth ${this.experienceValue} XP`);\r\n    }\r\n    \r\n    private findNearbyBricks(radius: number): EnhancedBrick[] {\r\n        const allBricks = this.node.parent?.getComponentsInChildren(EnhancedBrick) || [];\r\n        const nearby: EnhancedBrick[] = [];\r\n        \r\n        for (const brick of allBricks) {\r\n            if (brick === this) continue;\r\n            \r\n            const distance = Vec3.distance(this.node.getWorldPosition(), brick.node.getWorldPosition());\r\n            if (distance <= radius) {\r\n                nearby.push(brick);\r\n            }\r\n        }\r\n        \r\n        return nearby;\r\n    }\r\n    \r\n    private updateVisualState(): void {\r\n        if (!this._sprite) return;\r\n        \r\n        const healthRatio = this.health / this._maxHealth;\r\n        const currentColor = this._originalColor.clone();\r\n        \r\n        // Darken based on damage\r\n        currentColor.r = Math.floor(currentColor.r * healthRatio);\r\n        currentColor.g = Math.floor(currentColor.g * healthRatio);  \r\n        currentColor.b = Math.floor(currentColor.b * healthRatio);\r\n        \r\n        this._sprite.color = currentColor;\r\n    }\r\n    \r\n    private updateTimeBasedEffects(dt: number): void {\r\n        // Add time-based visual effects for special bricks\r\n        switch (this.brickType) {\r\n            case BrickType.ELECTRIC:\r\n                if (this._isElectric) {\r\n                    this.sparkleEffect(dt);\r\n                }\r\n                break;\r\n            case BrickType.MAGNETIC:\r\n                this.pulseEffect(dt);\r\n                break;\r\n        }\r\n    }\r\n    \r\n    // Visual effect methods\r\n    private showDamageEffect(): void {\r\n        if (!this._sprite) return;\r\n        \r\n        tween(this._sprite)\r\n            .to(0.1, { color: Color.WHITE })\r\n            .to(0.1, { color: this._sprite.color })\r\n            .start();\r\n    }\r\n    \r\n    private showPhaseEffect(): void {\r\n        if (!this._sprite) return;\r\n        \r\n        tween(this._sprite)\r\n            .to(0.2, { color: Color.TRANSPARENT })\r\n            .to(0.2, { color: this._originalColor })\r\n            .start();\r\n    }\r\n    \r\n    private showExplosionEffect(): void {\r\n        if (!this._sprite) return;\r\n        \r\n        tween(this._sprite)\r\n            .to(0.1, { color: Color.YELLOW })\r\n            .to(0.1, { color: this._sprite.color })\r\n            .start();\r\n    }\r\n    \r\n    private showElectricEffect(): void {\r\n        if (!this._sprite) return;\r\n        \r\n        tween(this._sprite)\r\n            .to(0.05, { color: Color.WHITE })\r\n            .to(0.05, { color: Color.CYAN })\r\n            .to(0.05, { color: this._sprite.color })\r\n            .start();\r\n    }\r\n    \r\n    private showShieldEffect(): void {\r\n        if (!this._sprite) return;\r\n        \r\n        tween(this._sprite)\r\n            .to(0.1, { color: Color.BLUE })\r\n            .to(0.1, { color: this._sprite.color })\r\n            .start();\r\n    }\r\n    \r\n    private sparkleEffect(dt: number): void {\r\n        // Implement sparkling effect for electric bricks\r\n    }\r\n    \r\n    private pulseEffect(dt: number): void {\r\n        // Implement pulsing effect for magnetic bricks  \r\n    }\r\n    \r\n    // Additional effect implementations would go here...\r\n    private createSplitBricks(): void { console.log('Brick split into smaller pieces'); }\r\n    private teleportBall(): void { console.log('Ball teleported to random location'); }\r\n    private applyCurse(): void { console.log('Curse applied to player'); }\r\n    private triggerCrystalChain(): void { console.log('Crystal chain reaction triggered'); }\r\n    private consumeBall(): void { console.log('Ball consumed by void brick'); }\r\n    private applyGravityEffect(): void { console.log('Gravity modified'); }\r\n    private applyTimeEffect(): void { console.log('Time flow modified'); }\r\n    private explodeAdjacent(center?: Vec3): void { \r\n        // Implementation from original Brick.ts\r\n        this.createExplosion(center);\r\n    }\r\n    \r\n    // Public accessors\r\n    public get currentHealth(): number { return this.health; }\r\n    public get maxHealth(): number { return this._maxHealth; }\r\n    public get isDestroyed(): boolean { return this.health <= 0; }\r\n    \r\n    // Shield system\r\n    public setShielded(shielded: boolean): void {\r\n        this._isShielded = shielded;\r\n        if (shielded && this._sprite) {\r\n            this._sprite.color = new Color(this._sprite.color.r, this._sprite.color.g, this._sprite.color.b, 200);\r\n        }\r\n    }\r\n}"]}