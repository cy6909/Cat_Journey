{"version":3,"sources":["file:///E:/work_space/wx/Cat_Journey/assets/scripts/GameManager.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","director","RelicManager","LevelManager","LevelType","CoreController","ccclass","property","GameState","GameManager","_currentState","PRE_START","_bricks","_ballNode","_paddleNode","_coreController","_levelManager","getInstance","_instance","onLoad","addPersistRootNode","node","destroy","onDestroy","start","initializeGame","initializeCore","initializeLevelManager","setState","createPaddle","createBall","setupLevel","scheduleOnce","PLAYING","coreNode","getComponent","console","warn","paddlePrefab","setPosition","addChild","ballPrefab","clearBricks","initializeLevel","levelType","getCurrentLevelType","BOSS","layout","getLevelLayout","level","createBricksFromLayout","basicLayout","row","length","col","Math","random","brickPrefab","brickContainer","startX","startY","brickWidth","brickHeight","spacing","brickType","brick","x","y","brickScript","setHealth","setDropsExperience","push","forEach","isValid","onBrickDestroyed","scoreValue","brickPosition","dropsExperience","score","powerUpDropChance","dropPowerUp","dropExperienceOrb","filter","checkLevelComplete","position","powerUps","multiBallPowerUpPrefab","laserPaddlePowerUpPrefab","availablePowerUps","prefab","randomPowerUp","floor","powerUpNode","onBallLost","lives","takeDamage","GAME_OVER","resetBall","onCoreAttacked","damage","log","onCoreDestroyed","onBossDefeated","onLevelComplete","experienceOrbPrefab","orbNode","ballScript","NORMAL","LEVEL_COMPLETE","relicManager","grantRandomRelic","resetLevel","adjustDifficulty","newState","getCurrentState","getBallPrefab","getScore","getLives","getLevel"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate, Vec3, director } from 'cc';\r\nimport { RelicManager } from './RelicManager';\r\nimport { LevelManager, LevelType } from './LevelManager';\r\nimport { CoreController } from './CoreController';\r\nimport { BossController } from './BossController';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum GameState {\r\n    PRE_START = 'PRE_START',\r\n    PLAYING = 'PLAYING',\r\n    LEVEL_COMPLETE = 'LEVEL_COMPLETE',\r\n    GAME_OVER = 'GAME_OVER'\r\n}\r\n\r\n@ccclass('GameManager')\r\nexport class GameManager extends Component {\r\n    @property(Prefab)\r\n    public brickPrefab: Prefab | null = null;\r\n\r\n    @property(Prefab)\r\n    public paddlePrefab: Prefab | null = null;\r\n\r\n    @property(Prefab)\r\n    public ballPrefab: Prefab | null = null;\r\n\r\n    @property(Prefab)\r\n    public multiBallPowerUpPrefab: Prefab | null = null;\r\n\r\n    @property(Prefab)\r\n    public laserPaddlePowerUpPrefab: Prefab | null = null;\r\n\r\n    @property\r\n    public powerUpDropChance: number = 0.2;\r\n\r\n    @property(Node)\r\n    public brickContainer: Node | null = null;\r\n\r\n    @property(Node)\r\n    public coreNode: Node | null = null;\r\n\r\n    @property(Prefab)\r\n    public experienceOrbPrefab: Prefab | null = null;\r\n\r\n    @property\r\n    public lives: number = 3;\r\n\r\n    @property\r\n    public score: number = 0;\r\n\r\n    @property\r\n    public level: number = 1;\r\n\r\n    private static _instance: GameManager | null = null;\r\n    private _currentState: GameState = GameState.PRE_START;\r\n    private _bricks: Node[] = [];\r\n    private _ballNode: Node | null = null;\r\n    private _paddleNode: Node | null = null;\r\n    private _coreController: CoreController | null = null;\r\n    private _levelManager: LevelManager | null = null;\r\n\r\n    public static getInstance(): GameManager | null {\r\n        return GameManager._instance;\r\n    }\r\n\r\n    protected onLoad(): void {\r\n        if (GameManager._instance === null) {\r\n            GameManager._instance = this;\r\n            director.addPersistRootNode(this.node);\r\n        } else {\r\n            this.node.destroy();\r\n            return;\r\n        }\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        if (GameManager._instance === this) {\r\n            GameManager._instance = null;\r\n        }\r\n    }\r\n\r\n    protected start(): void {\r\n        this.initializeGame();\r\n        this.initializeCore();\r\n        this.initializeLevelManager();\r\n    }\r\n\r\n    private initializeGame(): void {\r\n        this.setState(GameState.PRE_START);\r\n        this.createPaddle();\r\n        this.createBall();\r\n        this.setupLevel();\r\n        this.scheduleOnce(() => {\r\n            this.setState(GameState.PLAYING);\r\n        }, 2.0);\r\n    }\r\n\r\n    private initializeCore(): void {\r\n        if (this.coreNode) {\r\n            this._coreController = this.coreNode.getComponent(CoreController);\r\n            if (!this._coreController) {\r\n                console.warn('CoreController not found on coreNode');\r\n            }\r\n        }\r\n    }\r\n\r\n    private initializeLevelManager(): void {\r\n        this._levelManager = LevelManager.getInstance();\r\n        if (!this._levelManager) {\r\n            console.warn('LevelManager instance not found');\r\n        }\r\n    }\r\n\r\n    private createPaddle(): void {\r\n        if (!this.paddlePrefab) return;\r\n        \r\n        this._paddleNode = instantiate(this.paddlePrefab);\r\n        this._paddleNode.setPosition(0, -250, 0);\r\n        this.node.addChild(this._paddleNode);\r\n    }\r\n\r\n    private createBall(): void {\r\n        if (!this.ballPrefab) return;\r\n        \r\n        this._ballNode = instantiate(this.ballPrefab);\r\n        this._ballNode.setPosition(0, -150, 0);\r\n        this.node.addChild(this._ballNode);\r\n    }\r\n\r\n    private setupLevel(): void {\r\n        this.clearBricks();\r\n        \r\n        if (this._levelManager) {\r\n            this._levelManager.initializeLevel();\r\n            \r\n            const levelType = this._levelManager.getCurrentLevelType();\r\n            if (levelType !== LevelType.BOSS) {\r\n                const layout = this.getLevelLayout(this.level);\r\n                this.createBricksFromLayout(layout);\r\n            }\r\n        } else {\r\n            const layout = this.getLevelLayout(this.level);\r\n            this.createBricksFromLayout(layout);\r\n        }\r\n    }\r\n\r\n    private getLevelLayout(level: number): number[][] {\r\n        const basicLayout = [\r\n            [1, 1, 1, 1, 1, 1, 1, 1],\r\n            [1, 1, 1, 1, 1, 1, 1, 1],\r\n            [1, 1, 1, 1, 1, 1, 1, 1],\r\n            [1, 1, 1, 1, 1, 1, 1, 1]\r\n        ];\r\n\r\n        if (level > 1) {\r\n            for (let row = 0; row < basicLayout.length; row++) {\r\n                for (let col = 0; col < basicLayout[row].length; col++) {\r\n                    if (Math.random() < 0.3) {\r\n                        basicLayout[row][col] = 2;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return basicLayout;\r\n    }\r\n\r\n    private createBricksFromLayout(layout: number[][]): void {\r\n        if (!this.brickPrefab || !this.brickContainer) return;\r\n\r\n        const startX = -280;\r\n        const startY = 200;\r\n        const brickWidth = 80;\r\n        const brickHeight = 40;\r\n        const spacing = 10;\r\n\r\n        for (let row = 0; row < layout.length; row++) {\r\n            for (let col = 0; col < layout[row].length; col++) {\r\n                const brickType = layout[row][col];\r\n                if (brickType === 0) continue;\r\n\r\n                const brick = instantiate(this.brickPrefab);\r\n                const x = startX + col * (brickWidth + spacing);\r\n                const y = startY - row * (brickHeight + spacing);\r\n                \r\n                brick.setPosition(x, y, 0);\r\n                \r\n                const brickScript = brick.getComponent('Brick');\r\n                if (brickScript) {\r\n                    (brickScript as any).setHealth(brickType);\r\n                    \r\n                    // Some bricks drop experience orbs\r\n                    if (Math.random() < 0.1) { // 10% chance\r\n                        (brickScript as any).setDropsExperience(true);\r\n                    }\r\n                }\r\n\r\n                this.brickContainer.addChild(brick);\r\n                this._bricks.push(brick);\r\n            }\r\n        }\r\n    }\r\n\r\n    private clearBricks(): void {\r\n        this._bricks.forEach(brick => {\r\n            if (brick && brick.isValid) {\r\n                brick.destroy();\r\n            }\r\n        });\r\n        this._bricks = [];\r\n    }\r\n\r\n    public onBrickDestroyed(scoreValue: number = 10, brickPosition?: Vec3, dropsExperience: boolean = false): void {\r\n        this.score += scoreValue;\r\n        \r\n        if (brickPosition) {\r\n            // Drop power-ups\r\n            if (Math.random() < this.powerUpDropChance) {\r\n                this.dropPowerUp(brickPosition);\r\n            }\r\n            \r\n            // Drop experience orbs\r\n            if (dropsExperience) {\r\n                this.dropExperienceOrb(brickPosition);\r\n            }\r\n        }\r\n        \r\n        this._bricks = this._bricks.filter(brick => brick && brick.isValid);\r\n        \r\n        if (this._bricks.length === 0) {\r\n            this.checkLevelComplete();\r\n        }\r\n    }\r\n\r\n    private dropPowerUp(position: Vec3): void {\r\n        const powerUps = [this.multiBallPowerUpPrefab, this.laserPaddlePowerUpPrefab];\r\n        const availablePowerUps = powerUps.filter(prefab => prefab !== null);\r\n        \r\n        if (availablePowerUps.length === 0) return;\r\n        \r\n        const randomPowerUp = availablePowerUps[Math.floor(Math.random() * availablePowerUps.length)];\r\n        if (randomPowerUp) {\r\n            const powerUpNode = instantiate(randomPowerUp);\r\n            powerUpNode.setPosition(position);\r\n            this.node.addChild(powerUpNode);\r\n        }\r\n    }\r\n\r\n    public onBallLost(): void {\r\n        this.lives--;\r\n        \r\n        // Ball hitting core also deals damage\r\n        if (this._coreController) {\r\n            this._coreController.takeDamage(1, 'Ball lost');\r\n        }\r\n        \r\n        if (this.lives <= 0) {\r\n            this.setState(GameState.GAME_OVER);\r\n        } else {\r\n            this.resetBall();\r\n        }\r\n    }\r\n    \r\n    public onCoreAttacked(damage: number): void {\r\n        console.log(`Core attacked for ${damage} damage`);\r\n        \r\n        if (this._coreController) {\r\n            this._coreController.takeDamage(damage, 'External attack');\r\n        }\r\n    }\r\n    \r\n    public onCoreDestroyed(): void {\r\n        console.log('Core destroyed! Immediate game over!');\r\n        this.lives = 0;\r\n        this.setState(GameState.GAME_OVER);\r\n    }\r\n    \r\n    public onBossDefeated(scoreValue: number): void {\r\n        console.log(`Boss defeated! Awarded ${scoreValue} points`);\r\n        this.score += scoreValue;\r\n        \r\n        // Boss defeat triggers level completion\r\n        this.onLevelComplete();\r\n    }\r\n    \r\n    private dropExperienceOrb(position: Vec3): void {\r\n        if (!this.experienceOrbPrefab) return;\r\n        \r\n        const orbNode = instantiate(this.experienceOrbPrefab);\r\n        orbNode.setPosition(position);\r\n        this.node.addChild(orbNode);\r\n        console.log('Experience orb dropped');\r\n    }\r\n\r\n    private resetBall(): void {\r\n        if (this._ballNode) {\r\n            const ballScript = this._ballNode.getComponent('Ball');\r\n            if (ballScript) {\r\n                (ballScript as any).resetBall();\r\n            }\r\n        }\r\n    }\r\n\r\n    private checkLevelComplete(): void {\r\n        const levelType = this._levelManager ? this._levelManager.getCurrentLevelType() : LevelType.NORMAL;\r\n        \r\n        if (levelType === LevelType.BOSS) {\r\n            // Boss levels complete when boss is defeated (handled in onBossDefeated)\r\n            return;\r\n        }\r\n        \r\n        this.onLevelComplete();\r\n    }\r\n\r\n    public onLevelComplete(): void {\r\n        this.setState(GameState.LEVEL_COMPLETE);\r\n        this.level++;\r\n        \r\n        const relicManager = RelicManager.getInstance();\r\n        if (relicManager) {\r\n            relicManager.grantRandomRelic();\r\n        }\r\n        \r\n        // Reset level manager for next level\r\n        if (this._levelManager) {\r\n            this._levelManager.resetLevel();\r\n            this._levelManager.adjustDifficulty(this.level);\r\n        }\r\n        \r\n        this.scheduleOnce(() => {\r\n            this.setupLevel();\r\n            this.setState(GameState.PLAYING);\r\n        }, 3.0);\r\n    }\r\n\r\n    public setState(newState: GameState): void {\r\n        this._currentState = newState;\r\n        console.log(`Game State Changed: ${newState}`);\r\n    }\r\n\r\n    public getCurrentState(): GameState {\r\n        return this._currentState;\r\n    }\r\n\r\n    public getBallPrefab(): Prefab | null {\r\n        return this.ballPrefab;\r\n    }\r\n\r\n    public getScore(): number {\r\n        return this.score;\r\n    }\r\n\r\n    public getLives(): number {\r\n        return this.lives;\r\n    }\r\n\r\n    public getLevel(): number {\r\n        return this.level;\r\n    }\r\n}"]}