{"version":3,"sources":["file:///E:/work_space/wx/Cat_Journey/assets/scripts/powerups/MultiBallPowerUp.ts"],"names":["_decorator","instantiate","Vec3","PowerUp","PowerUpType","ccclass","property","MultiBallPowerUp","onLoad","powerUpType","MULTI_BALL","activateEffect","gameManager","getGameManager","ballPrefab","getBallPrefab","currentBall","getBallNode","currentPos","position","i","extraBalls","newBall","angle","Math","PI","offset","sin","cos","setPosition","add","canvas","node","parent","addChild","ballScript","getComponent","launch","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;;AACzBC,MAAAA,O,iBAAAA,O;AAASC,MAAAA,W,iBAAAA,W;;;;;;;;;OACZ;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;kCAGjBO,gB,WADZF,OAAO,CAAC,kBAAD,C,2BAAR,MACaE,gBADb;AAAA;AAAA,8BAC8C;AAAA;AAAA;;AAAA;AAAA;;AAIhCC,QAAAA,MAAM,GAAS;AACrB;AACA,eAAKC,WAAL,GAAmB;AAAA;AAAA,0CAAYC,UAA/B;AACA,gBAAMF,MAAN;AACH;;AAESG,QAAAA,cAAc,GAAS;AAC7B,gBAAMC,WAAW,GAAG,KAAKC,cAAL,EAApB;AACA,cAAI,CAACD,WAAL,EAAkB;AAElB,gBAAME,UAAU,GAAGF,WAAW,CAACG,aAAZ,EAAnB;AACA,cAAI,CAACD,UAAL,EAAiB;AAEjB,gBAAME,WAAW,GAAGJ,WAAW,CAACK,WAAZ,EAApB;AACA,cAAI,CAACD,WAAL,EAAkB;AAElB,gBAAME,UAAU,GAAGF,WAAW,CAACG,QAA/B;;AAEA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,UAAzB,EAAqCD,CAAC,EAAtC,EAA0C;AACtC,kBAAME,OAAO,GAAGrB,WAAW,CAACa,UAAD,CAA3B;AACA,kBAAMS,KAAK,GAAIC,IAAI,CAACC,EAAL,GAAU,CAAX,IAAiBL,CAAC,GAAG,KAAKC,UAAL,GAAkB,CAAtB,GAA0B,GAA3C,CAAd;AACA,kBAAMK,MAAM,GAAG,IAAIxB,IAAJ,CACXsB,IAAI,CAACG,GAAL,CAASJ,KAAT,IAAkB,EADP,EAEXC,IAAI,CAACI,GAAL,CAASL,KAAT,IAAkB,EAFP,EAGX,CAHW,CAAf;AAMAD,YAAAA,OAAO,CAACO,WAAR,CAAoBX,UAAU,CAACY,GAAX,CAAeJ,MAAf,CAApB,EATsC,CAWtC;;AACA,kBAAMK,MAAM,GAAGnB,WAAW,CAACoB,IAAZ,CAAiBC,MAAhC;;AACA,gBAAIF,MAAJ,EAAY;AACRA,cAAAA,MAAM,CAACG,QAAP,CAAgBZ,OAAhB;AACH,aAFD,MAEO;AACHV,cAAAA,WAAW,CAACoB,IAAZ,CAAiBE,QAAjB,CAA0BZ,OAA1B;AACH;;AAED,kBAAMa,UAAU,GAAGb,OAAO,CAACc,YAAR,CAAqB,MAArB,CAAnB;;AACA,gBAAID,UAAJ,EAAgB;AACXA,cAAAA,UAAD,CAAoBE,MAApB;AACH;AACJ;;AAEDC,UAAAA,OAAO,CAACC,GAAR,CAAa,8BAA6B,KAAKlB,UAAW,eAA1D;AACH;;AAhDyC,O,6EACzCf,Q;;;;;iBAC2B,C","sourcesContent":["import { _decorator, instantiate, Vec3 } from 'cc';\r\nimport { PowerUp, PowerUpType } from './PowerUp';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MultiBallPowerUp')\r\nexport class MultiBallPowerUp extends PowerUp {\r\n    @property\r\n    public extraBalls: number = 2;\r\n\r\n    protected onLoad(): void {\r\n        // Set power-up type before calling parent onLoad\r\n        this.powerUpType = PowerUpType.MULTI_BALL;\r\n        super.onLoad();\r\n    }\r\n\r\n    protected activateEffect(): void {\r\n        const gameManager = this.getGameManager();\r\n        if (!gameManager) return;\r\n\r\n        const ballPrefab = gameManager.getBallPrefab();\r\n        if (!ballPrefab) return;\r\n\r\n        const currentBall = gameManager.getBallNode();\r\n        if (!currentBall) return;\r\n\r\n        const currentPos = currentBall.position;\r\n        \r\n        for (let i = 0; i < this.extraBalls; i++) {\r\n            const newBall = instantiate(ballPrefab);\r\n            const angle = (Math.PI / 6) * (i - this.extraBalls / 2 + 0.5);\r\n            const offset = new Vec3(\r\n                Math.sin(angle) * 50,\r\n                Math.cos(angle) * 50,\r\n                0\r\n            );\r\n            \r\n            newBall.setPosition(currentPos.add(offset));\r\n            \r\n            // Add to Canvas instead of GameManager for consistent coordinate system\r\n            const canvas = gameManager.node.parent;\r\n            if (canvas) {\r\n                canvas.addChild(newBall);\r\n            } else {\r\n                gameManager.node.addChild(newBall);\r\n            }\r\n\r\n            const ballScript = newBall.getComponent('Ball');\r\n            if (ballScript) {\r\n                (ballScript as any).launch();\r\n            }\r\n        }\r\n\r\n        console.log(`MultiBall activated! Added ${this.extraBalls} extra balls.`);\r\n    }\r\n}"]}