{"version":3,"sources":["file:///E:/work_space/wx/Cat_Journey/assets/scripts/PowerUp.ts"],"names":["_decorator","Component","Collider2D","Contact2DType","RigidBody2D","Vec2","GameManager","ccclass","property","PowerUp","_rigidBody","_isCollected","onLoad","getComponent","collider","on","BEGIN_CONTACT","onBeginContact","linearVelocity","fallSpeed","onDestroy","off","selfCollider","otherCollider","node","name","collectPowerUp","destroy","activateEffect","duration","scheduleOnce","deactivateEffect","getGameManager","getInstance"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,U,OAAAA,U;AAAYC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;;AACrEC,MAAAA,W,iBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;yBAGRS,O,WADrBF,OAAO,CAAC,SAAD,C,2BAAR,MACsBE,OADtB,SACsCR,SADtC,CACgD;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAOpCS,UAPoC,GAOH,IAPG;AAAA,eAQpCC,YARoC,GAQZ,KARY;AAAA;;AAUlCC,QAAAA,MAAM,GAAS;AACrB,eAAKF,UAAL,GAAkB,KAAKG,YAAL,CAAkBT,WAAlB,CAAlB;AAEA,gBAAMU,QAAQ,GAAG,KAAKD,YAAL,CAAkBX,UAAlB,CAAjB;;AACA,cAAIY,QAAJ,EAAc;AACVA,YAAAA,QAAQ,CAACC,EAAT,CAAYZ,aAAa,CAACa,aAA1B,EAAyC,KAAKC,cAA9C,EAA8D,IAA9D;AACH;;AAED,cAAI,KAAKP,UAAT,EAAqB;AACjB,iBAAKA,UAAL,CAAgBQ,cAAhB,GAAiC,IAAIb,IAAJ,CAAS,CAAT,EAAY,CAAC,KAAKc,SAAlB,CAAjC;AACH;AACJ;;AAESC,QAAAA,SAAS,GAAS;AACxB,gBAAMN,QAAQ,GAAG,KAAKD,YAAL,CAAkBX,UAAlB,CAAjB;;AACA,cAAIY,QAAJ,EAAc;AACVA,YAAAA,QAAQ,CAACO,GAAT,CAAalB,aAAa,CAACa,aAA3B,EAA0C,KAAKC,cAA/C,EAA+D,IAA/D;AACH;AACJ;;AAEOA,QAAAA,cAAc,CAACK,YAAD,EAA2BC,aAA3B,EAA4D;AAC9E,cAAI,KAAKZ,YAAT,EAAuB;;AAEvB,cAAIY,aAAa,CAACC,IAAd,CAAmBC,IAAnB,KAA4B,QAA5B,IAAwCF,aAAa,CAACV,YAAd,CAA2B,kBAA3B,CAA5C,EAA4F;AACxF,iBAAKa,cAAL;AACH,WAFD,MAEO,IAAIH,aAAa,CAACV,YAAd,CAA2B,WAA3B,CAAJ,EAA6C;AAChD,iBAAKW,IAAL,CAAUG,OAAV;AACH;AACJ;;AAEOD,QAAAA,cAAc,GAAS;AAC3B,cAAI,KAAKf,YAAT,EAAuB;AAEvB,eAAKA,YAAL,GAAoB,IAApB;AACA,eAAKiB,cAAL;;AAEA,cAAI,KAAKC,QAAL,GAAgB,CAApB,EAAuB;AACnB,iBAAKC,YAAL,CAAkB,MAAM;AACpB,mBAAKC,gBAAL;AACH,aAFD,EAEG,KAAKF,QAFR;AAGH;;AAED,eAAKL,IAAL,CAAUG,OAAV;AACH;;AAISI,QAAAA,gBAAgB,GAAS,CAClC;;AAESC,QAAAA,cAAc,GAAuB;AAC3C,iBAAO;AAAA;AAAA,0CAAYC,WAAZ,EAAP;AACH;;AA9D2C,O,4EAC3CzB,Q;;;;;iBAC0B,G;;mFAE1BA,Q;;;;;iBACyB,I","sourcesContent":["import { _decorator, Component, Node, Collider2D, Contact2DType, RigidBody2D, Vec2 } from 'cc';\r\nimport { GameManager } from './GameManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PowerUp')\r\nexport abstract class PowerUp extends Component {\r\n    @property\r\n    public fallSpeed: number = 200;\r\n\r\n    @property\r\n    public duration: number = 10.0;\r\n\r\n    private _rigidBody: RigidBody2D | null = null;\r\n    private _isCollected: boolean = false;\r\n\r\n    protected onLoad(): void {\r\n        this._rigidBody = this.getComponent(RigidBody2D);\r\n        \r\n        const collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n\r\n        if (this._rigidBody) {\r\n            this._rigidBody.linearVelocity = new Vec2(0, -this.fallSpeed);\r\n        }\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        const collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.off(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n    }\r\n\r\n    private onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D): void {\r\n        if (this._isCollected) return;\r\n\r\n        if (otherCollider.node.name === 'Paddle' || otherCollider.getComponent('PaddleController')) {\r\n            this.collectPowerUp();\r\n        } else if (otherCollider.getComponent('DeathZone')) {\r\n            this.node.destroy();\r\n        }\r\n    }\r\n\r\n    private collectPowerUp(): void {\r\n        if (this._isCollected) return;\r\n        \r\n        this._isCollected = true;\r\n        this.activateEffect();\r\n        \r\n        if (this.duration > 0) {\r\n            this.scheduleOnce(() => {\r\n                this.deactivateEffect();\r\n            }, this.duration);\r\n        }\r\n\r\n        this.node.destroy();\r\n    }\r\n\r\n    protected abstract activateEffect(): void;\r\n\r\n    protected deactivateEffect(): void {\r\n    }\r\n\r\n    protected getGameManager(): GameManager | null {\r\n        return GameManager.getInstance();\r\n    }\r\n}"]}