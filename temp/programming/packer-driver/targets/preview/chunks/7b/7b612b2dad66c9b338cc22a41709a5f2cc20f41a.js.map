{"version":3,"sources":["file:///E:/work_space/wx/Cat_Journey/assets/scripts/BossController.ts"],"names":["_decorator","Component","Collider2D","Contact2DType","GameManager","ccclass","property","BossController","_currentHealth","_lastAttackTime","_moveDirection","onLoad","maxHealth","collider","getComponent","on","BEGIN_CONTACT","onBeginContact","start","schedule","performAttack","attackInterval","update","dt","updateMovement","updateAttackTimer","currentPos","node","position","newX","x","moveSpeed","setPosition","y","z","console","log","attackDamage","gameManager","getInstance","scheduleOnce","onCoreAttacked","selfCollider","otherCollider","contact","otherNode","name","includes","ballScript","damage","getDamage","takeDamage","destroy","onDestroyed","showDamageEffect","sprite","color","r","g","b","a","onBossDefeated","scoreValue","unschedule","getCurrentHealth","getMaxHealth","setHealth","health"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, RigidBody2D, Collider2D, Contact2DType, IPhysics2DContact, Vec2, Vec3 } from 'cc';\nimport { GameManager } from './GameManager';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('BossController')\nexport class BossController extends Component {\n    @property\n    public maxHealth: number = 100;\n    \n    @property\n    public attackDamage: number = 1;\n    \n    @property\n    public attackInterval: number = 5.0;\n    \n    @property\n    public moveSpeed: number = 50;\n    \n    @property\n    public scoreValue: number = 500;\n    \n    private _currentHealth: number = 0;\n    private _lastAttackTime: number = 0;\n    private _moveDirection: number = 1;\n    \n    protected onLoad(): void {\n        this._currentHealth = this.maxHealth;\n        \n        const collider = this.getComponent(Collider2D);\n        if (collider) {\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\n        }\n    }\n    \n    protected start(): void {\n        this.schedule(this.performAttack, this.attackInterval);\n    }\n    \n    protected update(dt: number): void {\n        this.updateMovement(dt);\n        this.updateAttackTimer(dt);\n    }\n    \n    private updateMovement(dt: number): void {\n        const currentPos = this.node.position;\n        const newX = currentPos.x + this._moveDirection * this.moveSpeed * dt;\n        \n        // Bounce off screen edges\n        if (newX > 400 || newX < -400) {\n            this._moveDirection *= -1;\n        }\n        \n        this.node.setPosition(newX, currentPos.y, currentPos.z);\n    }\n    \n    private updateAttackTimer(dt: number): void {\n        this._lastAttackTime += dt;\n    }\n    \n    private performAttack(): void {\n        console.log(`Boss attacks! Dealing ${this.attackDamage} damage`);\n        \n        const gameManager = GameManager.getInstance();\n        if (gameManager) {\n            // Boss attack causes core damage\n            this.scheduleOnce(() => {\n                gameManager.onCoreAttacked(this.attackDamage);\n            }, 0.1);\n        }\n    }\n    \n    private onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null): void {\n        const otherNode = otherCollider.node;\n        \n        // Check if hit by ball\n        if (otherNode.name.includes('Ball')) {\n            const ballScript = otherNode.getComponent('Ball');\n            const damage = ballScript ? (ballScript as any).getDamage() : 1;\n            this.takeDamage(damage);\n        }\n        \n        // Check if hit by laser\n        if (otherNode.name.includes('Laser')) {\n            this.takeDamage(2);\n            otherNode.destroy();\n        }\n    }\n    \n    public takeDamage(damage: number): void {\n        this._currentHealth -= damage;\n        console.log(`Boss takes ${damage} damage. Health: ${this._currentHealth}/${this.maxHealth}`);\n        \n        if (this._currentHealth <= 0) {\n            this.onDestroyed();\n        } else {\n            // Visual feedback for damage\n            this.showDamageEffect();\n        }\n    }\n    \n    private showDamageEffect(): void {\n        // Flash effect - change color briefly\n        const sprite = this.getComponent('cc.Sprite');\n        if (sprite) {\n            (sprite as any).color = { r: 255, g: 100, b: 100, a: 255 };\n            this.scheduleOnce(() => {\n                (sprite as any).color = { r: 255, g: 255, b: 255, a: 255 };\n            }, 0.1);\n        }\n    }\n    \n    private onDestroyed(): void {\n        console.log('Boss defeated!');\n        \n        const gameManager = GameManager.getInstance();\n        if (gameManager) {\n            gameManager.onBossDefeated(this.scoreValue);\n        }\n        \n        // Cleanup\n        this.unschedule(this.performAttack);\n        this.node.destroy();\n    }\n    \n    public getCurrentHealth(): number {\n        return this._currentHealth;\n    }\n    \n    public getMaxHealth(): number {\n        return this.maxHealth;\n    }\n    \n    public setHealth(health: number): void {\n        this.maxHealth = health;\n        this._currentHealth = health;\n    }\n}"]}