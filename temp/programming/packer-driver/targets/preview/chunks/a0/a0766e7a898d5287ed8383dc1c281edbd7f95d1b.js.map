{"version":3,"sources":["file:///D:/project/claudecode/wx/Cat_Journey/assets/scripts/ShopManager.ts"],"names":["_decorator","Component","sys","CurrencyType","PurchaseType","MonetizationManager","ccclass","property","ShopCategory","ItemRarity","ShopManager","type","_shopItems","Map","_purchaseRecords","_vipExclusiveItems","Set","_limitedOffers","_dailyRefreshItems","_lastRefreshDate","onLoad","initializeShopItems","loadPurchaseRecords","checkDailyRefresh","start","monetizationManager","getComponent","createCurrencyItems","createEquipmentItems","createConsumableItems","createVIPItems","createSpecialOffers","createLegendaryItems","set","id","name","description","category","CURRENCY","rarity","COMMON","realPrice","contents","subType","amount","iconPath","featured","RARE","hot","EPIC","data","frameId","originalPrice","discountPercent","LEGENDARY","currencyType","GEMS","currencyAmount","oneTimePurchase","paddleType","stats","damage","durability","autoRepair","levelRequirement","ballType","effects","coreType","health","damageReduction","EQUIPMENT","purchaseLimit","CONSUMABLES","COINS","duration","VIP","titleId","vipOnly","add","SPECIAL","new","weekendEndTime","Date","now","guaranteedRarity","bonusChance","probability","modeId","getShopItems","items","Array","from","values","filter","item","isVIP","isItemAvailable","sort","a","b","rarityOrder","common","rare","epic","legendary","getShopItem","itemId","get","canPurchaseItem","canPurchase","reason","getPlayerLevel","purchaseRecord","resetDailyPurchasesIfNeeded","purchaseCount","currentAmount","getCurrency","purchaseItem","purchaseCheck","success","message","purchaseType","getPurchaseTypeForItem","subtractCurrency","grantItemRewards","recordPurchase","savePurchaseRecords","getDailyRefreshItems","map","undefined","refreshDailyItems","refreshCost","generateDailyRefreshItems","Promise","resolve","cost","endTime","record","purchaseTime","today","toDateString","entries","recordDate","clear","availableItems","keys","i","randomIndex","Math","floor","random","length","selectedItem","splice","node","emit","console","log","purchaseTypeMap","GEMS_SMALL","GEMS_MEDIUM","GEMS_LARGE","VIP_MONTHLY","STARTER_PACK","LEGENDARY_PADDLE","LEGENDARY_BALL","LEGENDARY_CORE","LEGENDARY_RELIC","purchaseRecords","dailyRefreshItems","lastRefreshDate","limitedOffers","localStorage","setItem","JSON","stringify","getItem","parsed","parse","addSpecialOffer","durationHours","discountEndTime","getShopStatistics","totalItems","size","totalPurchases","reduce","sum","vipExclusiveItems","activeLimitedOffers"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, sys } from 'cc';\r\nimport { CurrencyType, PurchaseType, MonetizationManager } from './MonetizationManager';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum ShopCategory {\r\n    CURRENCY = 'currency',           // 货币包\r\n    EQUIPMENT = 'equipment',         // 装备商店\r\n    CONSUMABLES = 'consumables',     // 消耗品\r\n    VIP = 'vip',                    // VIP服务\r\n    SPECIAL = 'special',            // 特惠活动\r\n    LEGENDARY = 'legendary'         // 传说商店\r\n}\r\n\r\nexport enum ItemRarity {\r\n    COMMON = 'common',              // 普通\r\n    RARE = 'rare',                  // 稀有\r\n    EPIC = 'epic',                  // 史诗\r\n    LEGENDARY = 'legendary'         // 传说\r\n}\r\n\r\ninterface ShopItem {\r\n    id: string;\r\n    name: string;\r\n    description: string;\r\n    category: ShopCategory;\r\n    rarity: ItemRarity;\r\n    \r\n    // 价格信息\r\n    realPrice?: number;             // 人民币价格(分)\r\n    currencyType?: CurrencyType;    // 游戏币类型\r\n    currencyAmount?: number;        // 游戏币价格\r\n    \r\n    // 购买限制\r\n    purchaseLimit?: number;         // 购买次数限制\r\n    oneTimePurchase?: boolean;      // 是否一次性购买\r\n    vipOnly?: boolean;             // VIP专属\r\n    levelRequirement?: number;      // 等级要求\r\n    \r\n    // 折扣信息\r\n    originalPrice?: number;         // 原价\r\n    discountPercent?: number;       // 折扣百分比\r\n    discountEndTime?: number;       // 折扣结束时间\r\n    \r\n    // 商品内容\r\n    contents: ShopItemContent[];\r\n    \r\n    // 显示信息\r\n    iconPath?: string;              // 图标路径\r\n    featured?: boolean;             // 是否推荐\r\n    hot?: boolean;                 // 是否热门\r\n    new?: boolean;                 // 是否新品\r\n}\r\n\r\ninterface ShopItemContent {\r\n    type: 'currency' | 'item' | 'boost' | 'unlock';\r\n    subType: string;                // 具体类型\r\n    amount: number;                 // 数量\r\n    data?: any;                    // 额外数据\r\n}\r\n\r\ninterface PurchaseRecord {\r\n    itemId: string;\r\n    purchaseTime: number;\r\n    purchaseCount: number;\r\n}\r\n\r\n@ccclass('ShopManager')\r\nexport class ShopManager extends Component {\r\n    \r\n    @property({type: MonetizationManager})\r\n    public monetizationManager: MonetizationManager | null = null;\r\n    \r\n    // 商店物品配置\r\n    private _shopItems: Map<string, ShopItem> = new Map();\r\n    \r\n    // 购买记录\r\n    private _purchaseRecords: Map<string, PurchaseRecord> = new Map();\r\n    \r\n    // VIP专享物品\r\n    private _vipExclusiveItems: Set<string> = new Set();\r\n    \r\n    // 限时特惠物品\r\n    private _limitedOffers: Map<string, number> = new Map(); // itemId -> endTime\r\n    \r\n    // 每日刷新物品\r\n    private _dailyRefreshItems: Set<string> = new Set();\r\n    private _lastRefreshDate: string = '';\r\n    \r\n    protected onLoad(): void {\r\n        this.initializeShopItems();\r\n        this.loadPurchaseRecords();\r\n        this.checkDailyRefresh();\r\n    }\r\n    \r\n    protected start(): void {\r\n        if (!this.monetizationManager) {\r\n            this.monetizationManager = this.getComponent(MonetizationManager);\r\n        }\r\n    }\r\n    \r\n    private initializeShopItems(): void {\r\n        this.createCurrencyItems();\r\n        this.createEquipmentItems();\r\n        this.createConsumableItems();\r\n        this.createVIPItems();\r\n        this.createSpecialOffers();\r\n        this.createLegendaryItems();\r\n    }\r\n    \r\n    private createCurrencyItems(): void {\r\n        // 小宝石包\r\n        this._shopItems.set('gems_small', {\r\n            id: 'gems_small',\r\n            name: '小宝石包',\r\n            description: '100宝石，新手推荐',\r\n            category: ShopCategory.CURRENCY,\r\n            rarity: ItemRarity.COMMON,\r\n            realPrice: 600, // ¥6\r\n            contents: [\r\n                { type: 'currency', subType: 'gems', amount: 100 }\r\n            ],\r\n            iconPath: 'shop/gems_small',\r\n            featured: true\r\n        });\r\n        \r\n        // 中宝石包\r\n        this._shopItems.set('gems_medium', {\r\n            id: 'gems_medium',\r\n            name: '中宝石包',\r\n            description: '600宝石 + 100奖励宝石',\r\n            category: ShopCategory.CURRENCY,\r\n            rarity: ItemRarity.RARE,\r\n            realPrice: 3000, // ¥30\r\n            contents: [\r\n                { type: 'currency', subType: 'gems', amount: 600 },\r\n                { type: 'currency', subType: 'gems', amount: 100 } // 奖励\r\n            ],\r\n            iconPath: 'shop/gems_medium',\r\n            hot: true\r\n        });\r\n        \r\n        // 大宝石包\r\n        this._shopItems.set('gems_large', {\r\n            id: 'gems_large',\r\n            name: '大宝石包',\r\n            description: '2000宝石 + 500奖励宝石 + 专属头像框',\r\n            category: ShopCategory.CURRENCY,\r\n            rarity: ItemRarity.EPIC,\r\n            realPrice: 9800, // ¥98\r\n            contents: [\r\n                { type: 'currency', subType: 'gems', amount: 2000 },\r\n                { type: 'currency', subType: 'gems', amount: 500 }, // 奖励\r\n                { type: 'unlock', subType: 'avatar_frame', amount: 1, data: { frameId: 'golden_dragon' } }\r\n            ],\r\n            iconPath: 'shop/gems_large'\r\n        });\r\n        \r\n        // 金币宝石组合包\r\n        this._shopItems.set('combo_pack', {\r\n            id: 'combo_pack',\r\n            name: '财富组合包',\r\n            description: '500宝石 + 50000金币 + 体力药水x3',\r\n            category: ShopCategory.CURRENCY,\r\n            rarity: ItemRarity.RARE,\r\n            realPrice: 1800, // ¥18\r\n            originalPrice: 2400,\r\n            discountPercent: 25,\r\n            contents: [\r\n                { type: 'currency', subType: 'gems', amount: 500 },\r\n                { type: 'currency', subType: 'coins', amount: 50000 },\r\n                { type: 'item', subType: 'energy_potion', amount: 3 }\r\n            ],\r\n            iconPath: 'shop/combo_pack'\r\n        });\r\n    }\r\n    \r\n    private createEquipmentItems(): void {\r\n        // 传说挡板\r\n        this._shopItems.set('legendary_paddle', {\r\n            id: 'legendary_paddle',\r\n            name: '神话破坏者',\r\n            description: '传说级挡板：攻击力+50%，耐久度翻倍，自动修复',\r\n            category: ShopCategory.LEGENDARY,\r\n            rarity: ItemRarity.LEGENDARY,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 800,\r\n            oneTimePurchase: true,\r\n            contents: [\r\n                { \r\n                    type: 'item', \r\n                    subType: 'paddle', \r\n                    amount: 1, \r\n                    data: { \r\n                        paddleType: 'legendary_destroyer',\r\n                        stats: { damage: 1.5, durability: 2.0, autoRepair: true }\r\n                    } \r\n                }\r\n            ],\r\n            iconPath: 'shop/legendary_paddle',\r\n            featured: true\r\n        });\r\n        \r\n        // 传说弹球\r\n        this._shopItems.set('legendary_ball', {\r\n            id: 'legendary_ball',\r\n            name: '混沌之球',\r\n            description: '传说级弹球：随机3种效果，穿透+无限反弹',\r\n            category: ShopCategory.LEGENDARY,\r\n            rarity: ItemRarity.LEGENDARY,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 1000,\r\n            oneTimePurchase: true,\r\n            levelRequirement: 20,\r\n            contents: [\r\n                { \r\n                    type: 'item', \r\n                    subType: 'ball', \r\n                    amount: 1,\r\n                    data: { \r\n                        ballType: 'legendary_chaos',\r\n                        effects: ['piercing', 'infinite_bounce', 'random_effects']\r\n                    }\r\n                }\r\n            ],\r\n            iconPath: 'shop/legendary_ball'\r\n        });\r\n        \r\n        // 传说核心\r\n        this._shopItems.set('legendary_core', {\r\n            id: 'legendary_core',\r\n            name: '永恒之心',\r\n            description: '传说级核心：生命值+200%，25%免伤几率',\r\n            category: ShopCategory.LEGENDARY,\r\n            rarity: ItemRarity.LEGENDARY,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 1200,\r\n            oneTimePurchase: true,\r\n            levelRequirement: 25,\r\n            contents: [\r\n                { \r\n                    type: 'item', \r\n                    subType: 'core', \r\n                    amount: 1,\r\n                    data: { \r\n                        coreType: 'legendary_eternal',\r\n                        stats: { health: 3.0, damageReduction: 0.25 }\r\n                    }\r\n                }\r\n            ],\r\n            iconPath: 'shop/legendary_core'\r\n        });\r\n        \r\n        // 稀有装备随机包\r\n        this._shopItems.set('rare_equipment_pack', {\r\n            id: 'rare_equipment_pack',\r\n            name: '稀有装备包',\r\n            description: '随机获得一件稀有品质装备',\r\n            category: ShopCategory.EQUIPMENT,\r\n            rarity: ItemRarity.RARE,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 300,\r\n            purchaseLimit: 5, // 每日限购5个\r\n            contents: [\r\n                { type: 'item', subType: 'equipment_random', amount: 1, data: { rarity: 'rare' } }\r\n            ],\r\n            iconPath: 'shop/rare_equipment_pack'\r\n        });\r\n    }\r\n    \r\n    private createConsumableItems(): void {\r\n        // 体力药水\r\n        this._shopItems.set('energy_potion_small', {\r\n            id: 'energy_potion_small',\r\n            name: '小体力药水',\r\n            description: '立即恢复30点体力',\r\n            category: ShopCategory.CONSUMABLES,\r\n            rarity: ItemRarity.COMMON,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 20,\r\n            purchaseLimit: 10,\r\n            contents: [\r\n                { type: 'boost', subType: 'energy_restore', amount: 30 }\r\n            ],\r\n            iconPath: 'shop/energy_potion_small'\r\n        });\r\n        \r\n        this._shopItems.set('energy_potion_large', {\r\n            id: 'energy_potion_large',\r\n            name: '大体力药水',\r\n            description: '立即恢复满体力',\r\n            category: ShopCategory.CONSUMABLES,\r\n            rarity: ItemRarity.RARE,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 50,\r\n            purchaseLimit: 5,\r\n            contents: [\r\n                { type: 'boost', subType: 'energy_restore', amount: 100 }\r\n            ],\r\n            iconPath: 'shop/energy_potion_large'\r\n        });\r\n        \r\n        // 经验双倍卡\r\n        this._shopItems.set('exp_double_card', {\r\n            id: 'exp_double_card',\r\n            name: '经验双倍卡',\r\n            description: '1小时内获得双倍经验',\r\n            category: ShopCategory.CONSUMABLES,\r\n            rarity: ItemRarity.COMMON,\r\n            currencyType: CurrencyType.COINS,\r\n            currencyAmount: 5000,\r\n            contents: [\r\n                { type: 'boost', subType: 'exp_multiplier', amount: 2, data: { duration: 3600 } }\r\n            ],\r\n            iconPath: 'shop/exp_double_card'\r\n        });\r\n        \r\n        // 金币双倍卡\r\n        this._shopItems.set('coin_double_card', {\r\n            id: 'coin_double_card',\r\n            name: '金币双倍卡',\r\n            description: '1小时内获得双倍金币',\r\n            category: ShopCategory.CONSUMABLES,\r\n            rarity: ItemRarity.COMMON,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 30,\r\n            contents: [\r\n                { type: 'boost', subType: 'coin_multiplier', amount: 2, data: { duration: 3600 } }\r\n            ],\r\n            iconPath: 'shop/coin_double_card'\r\n        });\r\n        \r\n        // 复活币\r\n        this._shopItems.set('revival_coin', {\r\n            id: 'revival_coin',\r\n            name: '复活币',\r\n            description: '失败时可使用复活币继续游戏',\r\n            category: ShopCategory.CONSUMABLES,\r\n            rarity: ItemRarity.RARE,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 80,\r\n            purchaseLimit: 3,\r\n            contents: [\r\n                { type: 'item', subType: 'revival_token', amount: 1 }\r\n            ],\r\n            iconPath: 'shop/revival_coin'\r\n        });\r\n    }\r\n    \r\n    private createVIPItems(): void {\r\n        // 月度VIP\r\n        this._shopItems.set('vip_monthly', {\r\n            id: 'vip_monthly',\r\n            name: '月度VIP',\r\n            description: '30天VIP特权：双倍经验，体力恢复翻倍，专属商店',\r\n            category: ShopCategory.VIP,\r\n            rarity: ItemRarity.EPIC,\r\n            realPrice: 3000, // ¥30\r\n            contents: [\r\n                { type: 'unlock', subType: 'vip_status', amount: 30 } // 30天VIP\r\n            ],\r\n            iconPath: 'shop/vip_monthly',\r\n            hot: true\r\n        });\r\n        \r\n        // 季度VIP\r\n        this._shopItems.set('vip_seasonal', {\r\n            id: 'vip_seasonal',\r\n            name: '季度VIP',\r\n            description: '90天VIP特权 + 1000奖励宝石 + 专属称号',\r\n            category: ShopCategory.VIP,\r\n            rarity: ItemRarity.EPIC,\r\n            realPrice: 8000, // ¥80\r\n            originalPrice: 9000,\r\n            discountPercent: 11,\r\n            contents: [\r\n                { type: 'unlock', subType: 'vip_status', amount: 90 },\r\n                { type: 'currency', subType: 'gems', amount: 1000 },\r\n                { type: 'unlock', subType: 'title', amount: 1, data: { titleId: 'vip_patron' } }\r\n            ],\r\n            iconPath: 'shop/vip_seasonal'\r\n        });\r\n        \r\n        // VIP专享礼包 - 只有VIP才能看到和购买\r\n        this._shopItems.set('vip_exclusive_pack', {\r\n            id: 'vip_exclusive_pack',\r\n            name: 'VIP专享礼包',\r\n            description: 'VIP专属：稀有遗物x2 + 传说装备碎片x10',\r\n            category: ShopCategory.VIP,\r\n            rarity: ItemRarity.LEGENDARY,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 500,\r\n            vipOnly: true,\r\n            purchaseLimit: 1, // 每日限购1个\r\n            contents: [\r\n                { type: 'item', subType: 'relic_random', amount: 2, data: { rarity: 'rare' } },\r\n                { type: 'item', subType: 'legendary_fragments', amount: 10 }\r\n            ],\r\n            iconPath: 'shop/vip_exclusive_pack'\r\n        });\r\n        \r\n        this._vipExclusiveItems.add('vip_exclusive_pack');\r\n    }\r\n    \r\n    private createSpecialOffers(): void {\r\n        // 新手特惠包\r\n        this._shopItems.set('starter_pack', {\r\n            id: 'starter_pack',\r\n            name: '新手特惠礼包',\r\n            description: '限时优惠：1000宝石 + 传说遗物 + 新手装备',\r\n            category: ShopCategory.SPECIAL,\r\n            rarity: ItemRarity.EPIC,\r\n            realPrice: 600, // ¥6\r\n            originalPrice: 3000,\r\n            discountPercent: 80,\r\n            oneTimePurchase: true,\r\n            levelRequirement: 1, // 新手限定\r\n            contents: [\r\n                { type: 'currency', subType: 'gems', amount: 1000 },\r\n                { type: 'item', subType: 'relic_random', amount: 1, data: { rarity: 'legendary' } },\r\n                { type: 'item', subType: 'starter_equipment_set', amount: 1 }\r\n            ],\r\n            iconPath: 'shop/starter_pack',\r\n            featured: true,\r\n            hot: true,\r\n            new: true\r\n        });\r\n        \r\n        // 周末特惠\r\n        this._shopItems.set('weekend_special', {\r\n            id: 'weekend_special',\r\n            name: '周末狂欢包',\r\n            description: '限时特惠：双倍卡x5 + 复活币x3 + 500宝石',\r\n            category: ShopCategory.SPECIAL,\r\n            rarity: ItemRarity.RARE,\r\n            realPrice: 1200, // ¥12\r\n            originalPrice: 2000,\r\n            discountPercent: 40,\r\n            purchaseLimit: 2, // 周末限购2次\r\n            contents: [\r\n                { type: 'item', subType: 'exp_double_card', amount: 3 },\r\n                { type: 'item', subType: 'coin_double_card', amount: 2 },\r\n                { type: 'item', subType: 'revival_token', amount: 3 },\r\n                { type: 'currency', subType: 'gems', amount: 500 }\r\n            ],\r\n            iconPath: 'shop/weekend_special',\r\n            hot: true\r\n        });\r\n        \r\n        // 设置限时特惠结束时间（示例：7天后）\r\n        const weekendEndTime = Date.now() + 7 * 24 * 60 * 60 * 1000;\r\n        this._limitedOffers.set('weekend_special', weekendEndTime);\r\n    }\r\n    \r\n    private createLegendaryItems(): void {\r\n        // 传说遗物箱\r\n        this._shopItems.set('legendary_relic_box', {\r\n            id: 'legendary_relic_box',\r\n            name: '传说遗物箱',\r\n            description: '保底获得1个传说遗物，小概率获得神话遗物',\r\n            category: ShopCategory.LEGENDARY,\r\n            rarity: ItemRarity.LEGENDARY,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 600,\r\n            purchaseLimit: 3, // 每日限购3个\r\n            contents: [\r\n                { \r\n                    type: 'item', \r\n                    subType: 'relic_box', \r\n                    amount: 1, \r\n                    data: { \r\n                        guaranteedRarity: 'legendary',\r\n                        bonusChance: { rarity: 'mythic', probability: 0.05 }\r\n                    } \r\n                }\r\n            ],\r\n            iconPath: 'shop/legendary_relic_box',\r\n            featured: true\r\n        });\r\n        \r\n        // 装备强化石\r\n        this._shopItems.set('enhancement_stones', {\r\n            id: 'enhancement_stones',\r\n            name: '装备强化石',\r\n            description: '用于强化装备，提升装备属性',\r\n            category: ShopCategory.LEGENDARY,\r\n            rarity: ItemRarity.EPIC,\r\n            currencyType: CurrencyType.GEMS,\r\n            currencyAmount: 150,\r\n            contents: [\r\n                { type: 'item', subType: 'enhancement_stone', amount: 5 }\r\n            ],\r\n            iconPath: 'shop/enhancement_stones'\r\n        });\r\n        \r\n        // 终极挑战通行证\r\n        this._shopItems.set('ultimate_pass', {\r\n            id: 'ultimate_pass',\r\n            name: '终极挑战通行证',\r\n            description: '解锁终极挑战模式，获得独特奖励和称号',\r\n            category: ShopCategory.LEGENDARY,\r\n            rarity: ItemRarity.LEGENDARY,\r\n            realPrice: 5000, // ¥50\r\n            oneTimePurchase: true,\r\n            levelRequirement: 30,\r\n            contents: [\r\n                { type: 'unlock', subType: 'game_mode', amount: 1, data: { modeId: 'ultimate_challenge' } },\r\n                { type: 'unlock', subType: 'title', amount: 1, data: { titleId: 'ultimate_challenger' } }\r\n            ],\r\n            iconPath: 'shop/ultimate_pass'\r\n        });\r\n    }\r\n    \r\n    // 获取商店物品列表\r\n    public getShopItems(category?: ShopCategory): ShopItem[] {\r\n        let items = Array.from(this._shopItems.values());\r\n        \r\n        if (category) {\r\n            items = items.filter(item => item.category === category);\r\n        }\r\n        \r\n        // 过滤VIP专享物品\r\n        if (this.monetizationManager && !this.monetizationManager.isVIP()) {\r\n            items = items.filter(item => !item.vipOnly);\r\n        }\r\n        \r\n        // 检查限时特惠\r\n        items = items.filter(item => this.isItemAvailable(item.id));\r\n        \r\n        // 按特色和稀有度排序\r\n        items.sort((a, b) => {\r\n            // 推荐物品排在前面\r\n            if (a.featured && !b.featured) return -1;\r\n            if (!a.featured && b.featured) return 1;\r\n            \r\n            // 热门物品次之\r\n            if (a.hot && !b.hot) return -1;\r\n            if (!a.hot && b.hot) return 1;\r\n            \r\n            // 按稀有度排序\r\n            const rarityOrder = { \r\n                common: 0, \r\n                rare: 1, \r\n                epic: 2, \r\n                legendary: 3 \r\n            };\r\n            \r\n            return rarityOrder[b.rarity] - rarityOrder[a.rarity];\r\n        });\r\n        \r\n        return items;\r\n    }\r\n    \r\n    // 获取单个商店物品\r\n    public getShopItem(itemId: string): ShopItem | undefined {\r\n        return this._shopItems.get(itemId);\r\n    }\r\n    \r\n    // 检查物品是否可购买\r\n    public canPurchaseItem(itemId: string): { canPurchase: boolean; reason?: string } {\r\n        const item = this._shopItems.get(itemId);\r\n        if (!item) {\r\n            return { canPurchase: false, reason: '物品不存在' };\r\n        }\r\n        \r\n        // 检查VIP权限\r\n        if (item.vipOnly && this.monetizationManager && !this.monetizationManager.isVIP()) {\r\n            return { canPurchase: false, reason: '需要VIP权限' };\r\n        }\r\n        \r\n        // 检查等级要求\r\n        if (item.levelRequirement && this.getPlayerLevel() < item.levelRequirement) {\r\n            return { canPurchase: false, reason: `需要等级 ${item.levelRequirement}` };\r\n        }\r\n        \r\n        // 检查限时特惠\r\n        if (!this.isItemAvailable(itemId)) {\r\n            return { canPurchase: false, reason: '限时特惠已结束' };\r\n        }\r\n        \r\n        // 检查购买次数限制\r\n        const purchaseRecord = this._purchaseRecords.get(itemId);\r\n        if (item.purchaseLimit && purchaseRecord) {\r\n            this.resetDailyPurchasesIfNeeded();\r\n            if (purchaseRecord.purchaseCount >= item.purchaseLimit) {\r\n                return { canPurchase: false, reason: '已达购买上限' };\r\n            }\r\n        }\r\n        \r\n        // 检查一次性购买\r\n        if (item.oneTimePurchase && purchaseRecord && purchaseRecord.purchaseCount > 0) {\r\n            return { canPurchase: false, reason: '已购买过此物品' };\r\n        }\r\n        \r\n        // 检查货币是否充足\r\n        if (item.currencyType && item.currencyAmount && this.monetizationManager) {\r\n            const currentAmount = this.monetizationManager.getCurrency(item.currencyType);\r\n            if (currentAmount < item.currencyAmount) {\r\n                return { canPurchase: false, reason: `${item.currencyType}不足` };\r\n            }\r\n        }\r\n        \r\n        return { canPurchase: true };\r\n    }\r\n    \r\n    // 购买物品\r\n    public async purchaseItem(itemId: string): Promise<{ success: boolean; message?: string }> {\r\n        const purchaseCheck = this.canPurchaseItem(itemId);\r\n        if (!purchaseCheck.canPurchase) {\r\n            return { success: false, message: purchaseCheck.reason };\r\n        }\r\n        \r\n        const item = this._shopItems.get(itemId)!;\r\n        let success = false;\r\n        \r\n        if (item.realPrice) {\r\n            // 真实货币购买\r\n            if (this.monetizationManager) {\r\n                const purchaseType = this.getPurchaseTypeForItem(itemId);\r\n                if (purchaseType) {\r\n                    success = await this.monetizationManager.purchaseItem(purchaseType);\r\n                }\r\n            }\r\n        } else if (item.currencyType && item.currencyAmount) {\r\n            // 游戏币购买\r\n            if (this.monetizationManager && \r\n                this.monetizationManager.subtractCurrency(item.currencyType, item.currencyAmount)) {\r\n                success = true;\r\n                this.grantItemRewards(item);\r\n            }\r\n        }\r\n        \r\n        if (success) {\r\n            this.recordPurchase(itemId);\r\n            this.savePurchaseRecords();\r\n            return { success: true, message: '购买成功！' };\r\n        } else {\r\n            return { success: false, message: '购买失败，请重试' };\r\n        }\r\n    }\r\n    \r\n    // 获取每日刷新物品\r\n    public getDailyRefreshItems(): ShopItem[] {\r\n        this.checkDailyRefresh();\r\n        \r\n        return Array.from(this._dailyRefreshItems)\r\n            .map(itemId => this._shopItems.get(itemId))\r\n            .filter(item => item !== undefined) as ShopItem[];\r\n    }\r\n    \r\n    // 手动刷新每日物品（消耗宝石）\r\n    public refreshDailyItems(): Promise<{ success: boolean; cost?: number }> {\r\n        const refreshCost = 50; // 50宝石刷新\r\n        \r\n        if (this.monetizationManager && \r\n            this.monetizationManager.subtractCurrency(CurrencyType.GEMS, refreshCost)) {\r\n            this.generateDailyRefreshItems();\r\n            this.savePurchaseRecords();\r\n            return Promise.resolve({ success: true, cost: refreshCost });\r\n        }\r\n        \r\n        return Promise.resolve({ success: false });\r\n    }\r\n    \r\n    // 私有辅助方法\r\n    private isItemAvailable(itemId: string): boolean {\r\n        const endTime = this._limitedOffers.get(itemId);\r\n        if (endTime && Date.now() > endTime) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    \r\n    private recordPurchase(itemId: string): void {\r\n        let record = this._purchaseRecords.get(itemId);\r\n        if (!record) {\r\n            record = {\r\n                itemId: itemId,\r\n                purchaseTime: Date.now(),\r\n                purchaseCount: 0\r\n            };\r\n            this._purchaseRecords.set(itemId, record);\r\n        }\r\n        \r\n        record.purchaseCount++;\r\n        record.purchaseTime = Date.now();\r\n    }\r\n    \r\n    private resetDailyPurchasesIfNeeded(): void {\r\n        const today = new Date().toDateString();\r\n        \r\n        for (const [itemId, record] of this._purchaseRecords.entries()) {\r\n            const recordDate = new Date(record.purchaseTime).toDateString();\r\n            if (recordDate !== today) {\r\n                const item = this._shopItems.get(itemId);\r\n                if (item && item.purchaseLimit && !item.oneTimePurchase) {\r\n                    record.purchaseCount = 0; // 重置每日购买次数\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    private checkDailyRefresh(): void {\r\n        const today = new Date().toDateString();\r\n        if (this._lastRefreshDate !== today) {\r\n            this.generateDailyRefreshItems();\r\n            this._lastRefreshDate = today;\r\n            this.savePurchaseRecords();\r\n        }\r\n    }\r\n    \r\n    private generateDailyRefreshItems(): void {\r\n        this._dailyRefreshItems.clear();\r\n        \r\n        // 随机选择4个每日刷新物品\r\n        const availableItems = Array.from(this._shopItems.keys()).filter(itemId => {\r\n            const item = this._shopItems.get(itemId)!;\r\n            return !item.oneTimePurchase && item.category !== ShopCategory.VIP;\r\n        });\r\n        \r\n        for (let i = 0; i < 4; i++) {\r\n            const randomIndex = Math.floor(Math.random() * availableItems.length);\r\n            const selectedItem = availableItems[randomIndex];\r\n            this._dailyRefreshItems.add(selectedItem);\r\n            availableItems.splice(randomIndex, 1);\r\n        }\r\n    }\r\n    \r\n    private grantItemRewards(item: ShopItem): void {\r\n        // 通知外部系统发放奖励\r\n        this.node.emit('item-purchased', {\r\n            itemId: item.id,\r\n            contents: item.contents\r\n        });\r\n        \r\n        console.log(`Item purchased: ${item.name}`, item.contents);\r\n    }\r\n    \r\n    private getPurchaseTypeForItem(itemId: string): PurchaseType | null {\r\n        const purchaseTypeMap: { [key: string]: PurchaseType } = {\r\n            'gems_small': PurchaseType.GEMS_SMALL,\r\n            'gems_medium': PurchaseType.GEMS_MEDIUM,\r\n            'gems_large': PurchaseType.GEMS_LARGE,\r\n            'vip_monthly': PurchaseType.VIP_MONTHLY,\r\n            'starter_pack': PurchaseType.STARTER_PACK,\r\n            'legendary_paddle': PurchaseType.LEGENDARY_PADDLE,\r\n            'legendary_ball': PurchaseType.LEGENDARY_BALL,\r\n            'legendary_core': PurchaseType.LEGENDARY_CORE,\r\n            'legendary_relic_box': PurchaseType.LEGENDARY_RELIC\r\n        };\r\n        \r\n        return purchaseTypeMap[itemId] || null;\r\n    }\r\n    \r\n    private getPlayerLevel(): number {\r\n        // 获取玩家等级的逻辑，这里简化处理\r\n        return 1;\r\n    }\r\n    \r\n    // 数据持久化\r\n    private savePurchaseRecords(): void {\r\n        const data = {\r\n            purchaseRecords: Array.from(this._purchaseRecords.entries()),\r\n            dailyRefreshItems: Array.from(this._dailyRefreshItems),\r\n            lastRefreshDate: this._lastRefreshDate,\r\n            limitedOffers: Array.from(this._limitedOffers.entries())\r\n        };\r\n        \r\n        sys.localStorage.setItem('shop_manager_data', JSON.stringify(data));\r\n    }\r\n    \r\n    private loadPurchaseRecords(): void {\r\n        const data = sys.localStorage.getItem('shop_manager_data');\r\n        if (data) {\r\n            const parsed = JSON.parse(data);\r\n            \r\n            if (parsed.purchaseRecords) {\r\n                this._purchaseRecords = new Map(parsed.purchaseRecords);\r\n            }\r\n            \r\n            if (parsed.dailyRefreshItems) {\r\n                this._dailyRefreshItems = new Set(parsed.dailyRefreshItems);\r\n            }\r\n            \r\n            this._lastRefreshDate = parsed.lastRefreshDate || '';\r\n            \r\n            if (parsed.limitedOffers) {\r\n                this._limitedOffers = new Map(parsed.limitedOffers);\r\n            }\r\n        }\r\n    }\r\n    \r\n    // 调试和管理方法\r\n    public addSpecialOffer(itemId: string, discountPercent: number, durationHours: number): boolean {\r\n        const item = this._shopItems.get(itemId);\r\n        if (!item) return false;\r\n        \r\n        item.originalPrice = item.realPrice || item.currencyAmount || 0;\r\n        item.discountPercent = discountPercent;\r\n        \r\n        if (item.realPrice) {\r\n            item.realPrice = Math.floor(item.realPrice * (100 - discountPercent) / 100);\r\n        } else if (item.currencyAmount) {\r\n            item.currencyAmount = Math.floor(item.currencyAmount * (100 - discountPercent) / 100);\r\n        }\r\n        \r\n        const endTime = Date.now() + durationHours * 60 * 60 * 1000;\r\n        this._limitedOffers.set(itemId, endTime);\r\n        item.discountEndTime = endTime;\r\n        \r\n        this.savePurchaseRecords();\r\n        return true;\r\n    }\r\n    \r\n    public getShopStatistics(): any {\r\n        return {\r\n            totalItems: this._shopItems.size,\r\n            totalPurchases: Array.from(this._purchaseRecords.values())\r\n                .reduce((sum, record) => sum + record.purchaseCount, 0),\r\n            vipExclusiveItems: this._vipExclusiveItems.size,\r\n            activeLimitedOffers: this._limitedOffers.size,\r\n            dailyRefreshItems: this._dailyRefreshItems.size\r\n        };\r\n    }\r\n}"]}