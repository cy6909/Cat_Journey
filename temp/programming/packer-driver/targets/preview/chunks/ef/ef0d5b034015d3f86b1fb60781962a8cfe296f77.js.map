{"version":3,"sources":["file:///E:/work_space/wx/Cat_Journey/assets/scripts/ui/LevelTransitionManager.ts"],"names":["_decorator","Component","Node","Sprite","Label","UITransform","tween","Vec3","Color","view","Camera","Widget","ChapterTheme","ccclass","property","TransitionType","LevelType","LevelTransitionManager","type","transitionConfigs","Map","chapterThemes","isTransitioning","currentTransition","onLoad","initializeTransitionConfigs","initializeChapterThemes","setupTransitionLayers","set","COMBAT","duration","easing","effects","startValue","endValue","delay","audioClips","preloadAssets","ELITE","BOSS","SHOP","TREASURE","CAMPFIRE","EVENT","FOREST","backgroundColor","accentColor","transitionType","FADE_TO_BLACK","particleEffects","ambientSounds","loadingText","chapterTitle","chapterSubtitle","MOUNTAIN","SLIDE_LEFT","ABYSS","SPIRAL","transitionContainer","setParent","node","widget","addComponent","isAlignLeft","isAlignRight","isAlignTop","isAlignBottom","left","right","top","bottom","alignMode","AlignMode","ON_WINDOW_RESIZE","backgroundLayer","createLayer","contentLayer","effectsLayer","active","name","zIndex","layer","setPosition","transform","screenSize","getVisibleSize","setContentSize","width","height","setAnchorPoint","startLevelTransition","fromLevel","toLevel","chapter","nodeData","console","warn","Promise","resolve","log","executeTransition","fadeOutCurrentScene","showTransitionContent","preloadLevelAssets","playTransitionAnimation","fadeInNewScene","fadeOverlay","createFadeOverlay","getComponent","to","color","call","start","overlay","sprite","sizeMode","SizeMode","CUSTOM","levelType","chapterTheme","get","removeAllChildren","createChapterBackground","createLevelTypeDisplay","createLoadingText","createChapterInfo","enableParticleEffects","createTransitionParticles","theme","bgNode","displayNode","label","string","getLevelTypeDisplayName","fontSize","setScale","scale","textNode","repeatForever","infoContainer","titleNode","titleTransform","titleLabel","subtitleNode","subtitleTransform","subtitleLabel","position","forEach","effectType","index","particleNode","scheduleOnce","config","setTimeout","playFadeTransition","playSlideTransition","playSpiralTransition","transitionDuration","direction","startX","spiralTween","eulerAngles","getChildByName","destroy","quickTransition","chapterTransition","fromChapter","toChapter","fromTheme","toTheme","playChapterTransitionSequence","showChapterEnd","playChapterBridgeAnimation","showChapterBegin","endNode","isCurrentlyTransitioning","forceStopTransition"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, Label, UITransform, tween, Vec3, Color, view, Camera, Widget } from 'cc';\r\nimport { NodeType, ChapterTheme } from '../managers/MapManager';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum TransitionType {\r\n    FADE_TO_BLACK = 'fade_to_black',\r\n    SLIDE_LEFT = 'slide_left',\r\n    SLIDE_RIGHT = 'slide_right',\r\n    ZOOM_IN = 'zoom_in',\r\n    ZOOM_OUT = 'zoom_out',\r\n    SPIRAL = 'spiral',\r\n    SHATTER = 'shatter',\r\n    RIPPLE = 'ripple'\r\n}\r\n\r\nexport enum LevelType {\r\n    COMBAT = 'combat',\r\n    ELITE = 'elite',\r\n    BOSS = 'boss',\r\n    SHOP = 'shop',\r\n    TREASURE = 'treasure',\r\n    CAMPFIRE = 'campfire',\r\n    EVENT = 'event'\r\n}\r\n\r\ninterface TransitionConfig {\r\n    duration: number;\r\n    easing: string;\r\n    effects: TransitionEffect[];\r\n    audioClips: string[];\r\n    preloadAssets: string[];\r\n}\r\n\r\ninterface TransitionEffect {\r\n    type: 'color' | 'scale' | 'position' | 'rotation' | 'opacity';\r\n    startValue: any;\r\n    endValue: any;\r\n    delay: number;\r\n    duration: number;\r\n}\r\n\r\ninterface ChapterTransitionTheme {\r\n    backgroundColor: Color;\r\n    accentColor: Color;\r\n    transitionType: TransitionType;\r\n    particleEffects: string[];\r\n    ambientSounds: string[];\r\n    loadingText: string;\r\n    chapterTitle: string;\r\n    chapterSubtitle: string;\r\n}\r\n\r\n@ccclass('LevelTransitionManager')\r\nexport class LevelTransitionManager extends Component {\r\n    @property({type: Node})\r\n    public transitionContainer: Node | null = null;\r\n    \r\n    @property({type: Node})\r\n    public backgroundLayer: Node | null = null;\r\n    \r\n    @property({type: Node})\r\n    public contentLayer: Node | null = null;\r\n    \r\n    @property({type: Node})\r\n    public effectsLayer: Node | null = null;\r\n    \r\n    @property({type: Camera})\r\n    public transitionCamera: Camera | null = null;\r\n    \r\n    @property\r\n    public enableParticleEffects: boolean = true;\r\n    \r\n    @property\r\n    public enableAudioEffects: boolean = true;\r\n    \r\n    @property\r\n    public transitionDuration: number = 2.0;\r\n\r\n    private transitionConfigs: Map<LevelType, TransitionConfig> = new Map();\r\n    private chapterThemes: Map<ChapterTheme, ChapterTransitionTheme> = new Map();\r\n    private isTransitioning: boolean = false;\r\n    private currentTransition: Promise<void> | null = null;\r\n\r\n    protected onLoad(): void {\r\n        this.initializeTransitionConfigs();\r\n        this.initializeChapterThemes();\r\n        this.setupTransitionLayers();\r\n    }\r\n\r\n    private initializeTransitionConfigs(): void {\r\n        // 普通战斗过场配置\r\n        this.transitionConfigs.set(LevelType.COMBAT, {\r\n            duration: 1.5,\r\n            easing: 'quadInOut',\r\n            effects: [\r\n                {\r\n                    type: 'opacity',\r\n                    startValue: 0,\r\n                    endValue: 255,\r\n                    delay: 0,\r\n                    duration: 0.5\r\n                },\r\n                {\r\n                    type: 'scale',\r\n                    startValue: new Vec3(0.8, 0.8, 1),\r\n                    endValue: new Vec3(1.2, 1.2, 1),\r\n                    delay: 0.2,\r\n                    duration: 0.8\r\n                }\r\n            ],\r\n            audioClips: ['battle_start', 'sword_clash'],\r\n            preloadAssets: ['combat_background', 'combat_ui']\r\n        });\r\n\r\n        // 精英战斗过场配置\r\n        this.transitionConfigs.set(LevelType.ELITE, {\r\n            duration: 2.5,\r\n            easing: 'quartInOut',\r\n            effects: [\r\n                {\r\n                    type: 'color',\r\n                    startValue: new Color(255, 255, 255, 255),\r\n                    endValue: new Color(255, 215, 0, 255), // 金色\r\n                    delay: 0,\r\n                    duration: 1.0\r\n                },\r\n                {\r\n                    type: 'rotation',\r\n                    startValue: new Vec3(0, 0, -10),\r\n                    endValue: new Vec3(0, 0, 10),\r\n                    delay: 0.5,\r\n                    duration: 1.5\r\n                }\r\n            ],\r\n            audioClips: ['elite_horn', 'thunder_rumble'],\r\n            preloadAssets: ['elite_background', 'elite_effects']\r\n        });\r\n\r\n        // Boss战过场配置\r\n        this.transitionConfigs.set(LevelType.BOSS, {\r\n            duration: 3.0,\r\n            easing: 'sineInOut',\r\n            effects: [\r\n                {\r\n                    type: 'scale',\r\n                    startValue: new Vec3(0, 0, 1),\r\n                    endValue: new Vec3(1.5, 1.5, 1),\r\n                    delay: 0,\r\n                    duration: 2.0\r\n                },\r\n                {\r\n                    type: 'color',\r\n                    startValue: new Color(50, 50, 50, 255),\r\n                    endValue: new Color(200, 0, 0, 255), // 红色威胁感\r\n                    delay: 1.0,\r\n                    duration: 2.0\r\n                }\r\n            ],\r\n            audioClips: ['boss_roar', 'dramatic_music'],\r\n            preloadAssets: ['boss_background', 'boss_ui', 'boss_effects']\r\n        });\r\n\r\n        // 商店过场配置\r\n        this.transitionConfigs.set(LevelType.SHOP, {\r\n            duration: 1.2,\r\n            easing: 'backOut',\r\n            effects: [\r\n                {\r\n                    type: 'position',\r\n                    startValue: new Vec3(0, -500, 0),\r\n                    endValue: new Vec3(0, 0, 0),\r\n                    delay: 0,\r\n                    duration: 1.0\r\n                }\r\n            ],\r\n            audioClips: ['shop_bell', 'coin_jingle'],\r\n            preloadAssets: ['shop_background', 'shop_items']\r\n        });\r\n\r\n        // 宝藏过场配置\r\n        this.transitionConfigs.set(LevelType.TREASURE, {\r\n            duration: 2.0,\r\n            easing: 'elasticOut',\r\n            effects: [\r\n                {\r\n                    type: 'scale',\r\n                    startValue: new Vec3(0.1, 0.1, 1),\r\n                    endValue: new Vec3(1.0, 1.0, 1),\r\n                    delay: 0.3,\r\n                    duration: 1.5\r\n                },\r\n                {\r\n                    type: 'color',\r\n                    startValue: new Color(100, 100, 100, 255),\r\n                    endValue: new Color(255, 215, 0, 255), // 金色宝藏\r\n                    delay: 0.8,\r\n                    duration: 1.0\r\n                }\r\n            ],\r\n            audioClips: ['treasure_sparkle', 'chest_open'],\r\n            preloadAssets: ['treasure_background', 'treasure_chest']\r\n        });\r\n\r\n        // 篝火休息过场配置\r\n        this.transitionConfigs.set(LevelType.CAMPFIRE, {\r\n            duration: 1.8,\r\n            easing: 'quadOut',\r\n            effects: [\r\n                {\r\n                    type: 'opacity',\r\n                    startValue: 0,\r\n                    endValue: 255,\r\n                    delay: 0,\r\n                    duration: 1.0\r\n                },\r\n                {\r\n                    type: 'color',\r\n                    startValue: new Color(50, 50, 50, 255),\r\n                    endValue: new Color(255, 150, 50, 255), // 温暖橙色\r\n                    delay: 0.5,\r\n                    duration: 1.3\r\n                }\r\n            ],\r\n            audioClips: ['fire_crackle', 'peaceful_ambient'],\r\n            preloadAssets: ['campfire_background']\r\n        });\r\n\r\n        // 随机事件过场配置\r\n        this.transitionConfigs.set(LevelType.EVENT, {\r\n            duration: 1.6,\r\n            easing: 'quartOut',\r\n            effects: [\r\n                {\r\n                    type: 'rotation',\r\n                    startValue: new Vec3(0, 0, 0),\r\n                    endValue: new Vec3(0, 0, 360),\r\n                    delay: 0,\r\n                    duration: 1.6\r\n                },\r\n                {\r\n                    type: 'color',\r\n                    startValue: new Color(255, 255, 255, 255),\r\n                    endValue: new Color(150, 255, 150, 255), // 神秘绿色\r\n                    delay: 0.4,\r\n                    duration: 1.2\r\n                }\r\n            ],\r\n            audioClips: ['mystery_chime', 'wind_whisper'],\r\n            preloadAssets: ['event_background']\r\n        });\r\n    }\r\n\r\n    private initializeChapterThemes(): void {\r\n        // 森林章节过场主题\r\n        this.chapterThemes.set(ChapterTheme.FOREST, {\r\n            backgroundColor: new Color(20, 60, 30, 255),\r\n            accentColor: new Color(144, 238, 144, 255),\r\n            transitionType: TransitionType.FADE_TO_BLACK,\r\n            particleEffects: ['falling_leaves', 'fireflies', 'pollen_drift'],\r\n            ambientSounds: ['forest_ambient', 'bird_chirps', 'wind_rustling'],\r\n            loadingText: '进入翠绿森林...',\r\n            chapterTitle: '第一章：翠绿森林',\r\n            chapterSubtitle: '古老的树木守护着失落的秘密'\r\n        });\r\n\r\n        // 雪山章节过场主题\r\n        this.chapterThemes.set(ChapterTheme.MOUNTAIN, {\r\n            backgroundColor: new Color(30, 50, 80, 255),\r\n            accentColor: new Color(200, 220, 255, 255),\r\n            transitionType: TransitionType.SLIDE_LEFT,\r\n            particleEffects: ['snowfall', 'aurora_shimmer', 'ice_crystals'],\r\n            ambientSounds: ['mountain_wind', 'ice_crack', 'aurora_hum'],\r\n            loadingText: '攀登冰雪山峰...',\r\n            chapterTitle: '第二章：冰雪山峰',\r\n            chapterSubtitle: '在严寒中寻找内心的力量'\r\n        });\r\n\r\n        // 深渊章节过场主题\r\n        this.chapterThemes.set(ChapterTheme.ABYSS, {\r\n            backgroundColor: new Color(50, 20, 60, 255),\r\n            accentColor: new Color(255, 100, 255, 255),\r\n            transitionType: TransitionType.SPIRAL,\r\n            particleEffects: ['void_rifts', 'energy_sparks', 'plasma_flows'],\r\n            ambientSounds: ['void_whispers', 'energy_hum', 'reality_distortion'],\r\n            loadingText: '深入虚无深渊...',\r\n            chapterTitle: '第三章：虚无深渊',\r\n            chapterSubtitle: '在黑暗中面对最终的挑战'\r\n        });\r\n    }\r\n\r\n    private setupTransitionLayers(): void {\r\n        if (!this.transitionContainer) {\r\n            this.transitionContainer = new Node('TransitionContainer');\r\n            this.transitionContainer.setParent(this.node);\r\n            \r\n            // 设置全屏覆盖\r\n            const widget = this.transitionContainer.addComponent(Widget);\r\n            widget.isAlignLeft = widget.isAlignRight = true;\r\n            widget.isAlignTop = widget.isAlignBottom = true;\r\n            widget.left = widget.right = widget.top = widget.bottom = 0;\r\n            widget.alignMode = Widget.AlignMode.ON_WINDOW_RESIZE;\r\n        }\r\n\r\n        // 创建分层\r\n        this.backgroundLayer = this.createLayer('BackgroundLayer', -100);\r\n        this.contentLayer = this.createLayer('ContentLayer', 0);\r\n        this.effectsLayer = this.createLayer('EffectsLayer', 100);\r\n        \r\n        // 默认隐藏过场容器\r\n        this.transitionContainer.active = false;\r\n    }\r\n\r\n    private createLayer(name: string, zIndex: number): Node {\r\n        const layer = new Node(name);\r\n        layer.setParent(this.transitionContainer);\r\n        layer.setPosition(0, 0, zIndex);\r\n        \r\n        const transform = layer.addComponent(UITransform);\r\n        const screenSize = view.getVisibleSize();\r\n        transform.setContentSize(screenSize.width, screenSize.height);\r\n        transform.setAnchorPoint(0.5, 0.5);\r\n        \r\n        return layer;\r\n    }\r\n\r\n    // 公共接口：开始关卡过场动画\r\n    public async startLevelTransition(\r\n        fromLevel: LevelType, \r\n        toLevel: LevelType, \r\n        chapter: ChapterTheme,\r\n        nodeData?: any\r\n    ): Promise<void> {\r\n        if (this.isTransitioning) {\r\n            console.warn('Transition already in progress');\r\n            return this.currentTransition || Promise.resolve();\r\n        }\r\n\r\n        this.isTransitioning = true;\r\n        console.log(`Starting transition: ${fromLevel} -> ${toLevel} (Chapter: ${chapter})`);\r\n\r\n        this.currentTransition = this.executeTransition(fromLevel, toLevel, chapter, nodeData);\r\n        \r\n        try {\r\n            await this.currentTransition;\r\n        } finally {\r\n            this.isTransitioning = false;\r\n            this.currentTransition = null;\r\n        }\r\n    }\r\n\r\n    private async executeTransition(\r\n        fromLevel: LevelType,\r\n        toLevel: LevelType,\r\n        chapter: ChapterTheme,\r\n        nodeData?: any\r\n    ): Promise<void> {\r\n        // 显示过场容器\r\n        this.transitionContainer!.active = true;\r\n        \r\n        // 第一阶段：淡出当前场景\r\n        await this.fadeOutCurrentScene();\r\n        \r\n        // 第二阶段：显示过场内容\r\n        await this.showTransitionContent(toLevel, chapter, nodeData);\r\n        \r\n        // 第三阶段：预加载资源\r\n        await this.preloadLevelAssets(toLevel);\r\n        \r\n        // 第四阶段：过场动画\r\n        await this.playTransitionAnimation(toLevel, chapter);\r\n        \r\n        // 第五阶段：淡入新场景\r\n        await this.fadeInNewScene();\r\n        \r\n        // 隐藏过场容器\r\n        this.transitionContainer!.active = false;\r\n        \r\n        console.log('Transition completed');\r\n    }\r\n\r\n    private async fadeOutCurrentScene(): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            // 创建黑色遮罩\r\n            const fadeOverlay = this.createFadeOverlay();\r\n            \r\n            // 淡入黑色遮罩\r\n            tween(fadeOverlay.getComponent(Sprite)!)\r\n                .to(0.5, { color: new Color(0, 0, 0, 255) })\r\n                .call(() => resolve())\r\n                .start();\r\n        });\r\n    }\r\n\r\n    private createFadeOverlay(): Node {\r\n        const overlay = new Node('FadeOverlay');\r\n        overlay.setParent(this.backgroundLayer);\r\n        \r\n        const transform = overlay.addComponent(UITransform);\r\n        const screenSize = view.getVisibleSize();\r\n        transform.setContentSize(screenSize.width, screenSize.height);\r\n        transform.setAnchorPoint(0.5, 0.5);\r\n        \r\n        const sprite = overlay.addComponent(Sprite);\r\n        sprite.color = new Color(0, 0, 0, 0); // 初始透明\r\n        sprite.sizeMode = Sprite.SizeMode.CUSTOM;\r\n        \r\n        return overlay;\r\n    }\r\n\r\n    private async showTransitionContent(\r\n        levelType: LevelType, \r\n        chapter: ChapterTheme, \r\n        nodeData?: any\r\n    ): Promise<void> {\r\n        const chapterTheme = this.chapterThemes.get(chapter);\r\n        if (!chapterTheme) return;\r\n\r\n        // 清理之前的内容\r\n        this.contentLayer!.removeAllChildren();\r\n        \r\n        // 创建章节背景\r\n        this.createChapterBackground(chapterTheme);\r\n        \r\n        // 创建关卡类型显示\r\n        this.createLevelTypeDisplay(levelType, chapterTheme);\r\n        \r\n        // 创建加载文本\r\n        this.createLoadingText(chapterTheme.loadingText);\r\n        \r\n        // 创建章节信息\r\n        this.createChapterInfo(chapterTheme);\r\n        \r\n        // 添加特效\r\n        if (this.enableParticleEffects) {\r\n            this.createTransitionParticles(chapterTheme);\r\n        }\r\n    }\r\n\r\n    private createChapterBackground(theme: ChapterTransitionTheme): void {\r\n        const bgNode = new Node('ChapterBackground');\r\n        bgNode.setParent(this.contentLayer);\r\n        \r\n        const transform = bgNode.addComponent(UITransform);\r\n        const screenSize = view.getVisibleSize();\r\n        transform.setContentSize(screenSize.width, screenSize.height);\r\n        transform.setAnchorPoint(0.5, 0.5);\r\n        \r\n        const sprite = bgNode.addComponent(Sprite);\r\n        sprite.color = theme.backgroundColor;\r\n        sprite.sizeMode = Sprite.SizeMode.CUSTOM;\r\n    }\r\n\r\n    private createLevelTypeDisplay(levelType: LevelType, theme: ChapterTransitionTheme): void {\r\n        const displayNode = new Node('LevelTypeDisplay');\r\n        displayNode.setParent(this.contentLayer);\r\n        displayNode.setPosition(0, 100, 0);\r\n        \r\n        const transform = displayNode.addComponent(UITransform);\r\n        transform.setContentSize(300, 80);\r\n        transform.setAnchorPoint(0.5, 0.5);\r\n        \r\n        const label = displayNode.addComponent(Label);\r\n        label.string = this.getLevelTypeDisplayName(levelType);\r\n        label.fontSize = 48;\r\n        label.color = theme.accentColor;\r\n        \r\n        // 添加入场动画\r\n        displayNode.setScale(0, 0, 1);\r\n        tween(displayNode)\r\n            .to(0.8, { scale: new Vec3(1, 1, 1) })\r\n            .start();\r\n    }\r\n\r\n    private getLevelTypeDisplayName(levelType: LevelType): string {\r\n        switch (levelType) {\r\n            case LevelType.COMBAT: return '战斗关卡';\r\n            case LevelType.ELITE: return '精英挑战';\r\n            case LevelType.BOSS: return 'Boss战';\r\n            case LevelType.SHOP: return '神秘商店';\r\n            case LevelType.TREASURE: return '宝藏房间';\r\n            case LevelType.CAMPFIRE: return '休息篝火';\r\n            case LevelType.EVENT: return '随机事件';\r\n            default: return '未知关卡';\r\n        }\r\n    }\r\n\r\n    private createLoadingText(loadingText: string): void {\r\n        const textNode = new Node('LoadingText');\r\n        textNode.setParent(this.contentLayer);\r\n        textNode.setPosition(0, -100, 0);\r\n        \r\n        const transform = textNode.addComponent(UITransform);\r\n        transform.setContentSize(400, 40);\r\n        transform.setAnchorPoint(0.5, 0.5);\r\n        \r\n        const label = textNode.addComponent(Label);\r\n        label.string = loadingText;\r\n        label.fontSize = 24;\r\n        label.color = new Color(255, 255, 255, 255);\r\n        \r\n        // 添加脉动动画\r\n        tween(label)\r\n            .repeatForever(\r\n                tween()\r\n                    .to(1.0, { color: new Color(255, 255, 255, 150) })\r\n                    .to(1.0, { color: new Color(255, 255, 255, 255) })\r\n            )\r\n            .start();\r\n    }\r\n\r\n    private createChapterInfo(theme: ChapterTransitionTheme): void {\r\n        const infoContainer = new Node('ChapterInfo');\r\n        infoContainer.setParent(this.contentLayer);\r\n        infoContainer.setPosition(0, -200, 0);\r\n        \r\n        // 章节标题\r\n        const titleNode = new Node('ChapterTitle');\r\n        titleNode.setParent(infoContainer);\r\n        titleNode.setPosition(0, 20, 0);\r\n        \r\n        const titleTransform = titleNode.addComponent(UITransform);\r\n        titleTransform.setContentSize(500, 40);\r\n        titleTransform.setAnchorPoint(0.5, 0.5);\r\n        \r\n        const titleLabel = titleNode.addComponent(Label);\r\n        titleLabel.string = theme.chapterTitle;\r\n        titleLabel.fontSize = 32;\r\n        titleLabel.color = theme.accentColor;\r\n        \r\n        // 章节副标题\r\n        const subtitleNode = new Node('ChapterSubtitle');\r\n        subtitleNode.setParent(infoContainer);\r\n        subtitleNode.setPosition(0, -20, 0);\r\n        \r\n        const subtitleTransform = subtitleNode.addComponent(UITransform);\r\n        subtitleTransform.setContentSize(600, 30);\r\n        subtitleTransform.setAnchorPoint(0.5, 0.5);\r\n        \r\n        const subtitleLabel = subtitleNode.addComponent(Label);\r\n        subtitleLabel.string = theme.chapterSubtitle;\r\n        subtitleLabel.fontSize = 18;\r\n        subtitleLabel.color = new Color(200, 200, 200, 255);\r\n        \r\n        // 入场动画\r\n        infoContainer.setPosition(0, -300, 0);\r\n        tween(infoContainer)\r\n            .delay(0.5)\r\n            .to(1.0, { position: new Vec3(0, -200, 0) })\r\n            .start();\r\n    }\r\n\r\n    private createTransitionParticles(theme: ChapterTransitionTheme): void {\r\n        theme.particleEffects.forEach((effectType, index) => {\r\n            const particleNode = new Node(`Particle_${effectType}`);\r\n            particleNode.setParent(this.effectsLayer);\r\n            \r\n            // 这里应该添加具体的粒子系统\r\n            console.log(`Creating transition particle: ${effectType}`);\r\n            \r\n            // 延迟启动不同的粒子效果\r\n            this.scheduleOnce(() => {\r\n                console.log(`Starting particle effect: ${effectType}`);\r\n            }, index * 0.3);\r\n        });\r\n    }\r\n\r\n    private async preloadLevelAssets(levelType: LevelType): Promise<void> {\r\n        const config = this.transitionConfigs.get(levelType);\r\n        if (!config) return;\r\n\r\n        console.log(`Preloading assets for ${levelType}:`, config.preloadAssets);\r\n        \r\n        // 模拟资源加载时间\r\n        return new Promise<void>((resolve) => {\r\n            setTimeout(() => {\r\n                console.log('Assets preloaded successfully');\r\n                resolve();\r\n            }, 800);\r\n        });\r\n    }\r\n\r\n    private async playTransitionAnimation(levelType: LevelType, chapter: ChapterTheme): Promise<void> {\r\n        const config = this.transitionConfigs.get(levelType);\r\n        const theme = this.chapterThemes.get(chapter);\r\n        \r\n        if (!config || !theme) return;\r\n\r\n        console.log(`Playing transition animation: ${theme.transitionType}`);\r\n\r\n        // 根据主题类型播放不同的过场动画\r\n        switch (theme.transitionType) {\r\n            case TransitionType.FADE_TO_BLACK:\r\n                await this.playFadeTransition();\r\n                break;\r\n            case TransitionType.SLIDE_LEFT:\r\n                await this.playSlideTransition('left');\r\n                break;\r\n            case TransitionType.SPIRAL:\r\n                await this.playSpiralTransition();\r\n                break;\r\n            default:\r\n                await this.playFadeTransition();\r\n        }\r\n    }\r\n\r\n    private async playFadeTransition(): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            const duration = this.transitionDuration;\r\n            \r\n            // 创建渐变效果\r\n            tween(this.contentLayer!)\r\n                .to(duration * 0.3, { scale: new Vec3(1.1, 1.1, 1) })\r\n                .to(duration * 0.4, { scale: new Vec3(0.9, 0.9, 1) })\r\n                .to(duration * 0.3, { scale: new Vec3(1.0, 1.0, 1) })\r\n                .call(() => resolve())\r\n                .start();\r\n        });\r\n    }\r\n\r\n    private async playSlideTransition(direction: string): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            const screenSize = view.getVisibleSize();\r\n            const startX = direction === 'left' ? screenSize.width : -screenSize.width;\r\n            \r\n            this.contentLayer!.setPosition(startX, 0, 0);\r\n            \r\n            tween(this.contentLayer!)\r\n                .to(this.transitionDuration, { position: new Vec3(0, 0, 0) })\r\n                .call(() => resolve())\r\n                .start();\r\n        });\r\n    }\r\n\r\n    private async playSpiralTransition(): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            const spiralTween = tween(this.contentLayer!)\r\n                .to(this.transitionDuration, { \r\n                    eulerAngles: new Vec3(0, 0, 720), // 旋转两圈\r\n                    scale: new Vec3(0.1, 0.1, 1)\r\n                })\r\n                .to(this.transitionDuration * 0.5, {\r\n                    eulerAngles: new Vec3(0, 0, 0),\r\n                    scale: new Vec3(1.0, 1.0, 1)\r\n                })\r\n                .call(() => resolve())\r\n                .start();\r\n        });\r\n    }\r\n\r\n    private async fadeInNewScene(): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            // 淡出过场遮罩\r\n            const fadeOverlay = this.backgroundLayer!.getChildByName('FadeOverlay');\r\n            if (fadeOverlay) {\r\n                const sprite = fadeOverlay.getComponent(Sprite);\r\n                if (sprite) {\r\n                    tween(sprite)\r\n                        .to(0.5, { color: new Color(0, 0, 0, 0) })\r\n                        .call(() => {\r\n                            fadeOverlay.destroy();\r\n                            resolve();\r\n                        })\r\n                        .start();\r\n                } else {\r\n                    resolve();\r\n                }\r\n            } else {\r\n                resolve();\r\n            }\r\n        });\r\n    }\r\n\r\n    // 快速过场（用于非重要场景切换）\r\n    public async quickTransition(toLevel: LevelType): Promise<void> {\r\n        if (this.isTransitioning) return;\r\n\r\n        this.isTransitioning = true;\r\n        \r\n        try {\r\n            this.transitionContainer!.active = true;\r\n            \r\n            // 简单的淡入淡出\r\n            const overlay = this.createFadeOverlay();\r\n            const sprite = overlay.getComponent(Sprite)!;\r\n            \r\n            // 淡入黑色\r\n            await new Promise<void>((resolve) => {\r\n                tween(sprite)\r\n                    .to(0.3, { color: new Color(0, 0, 0, 255) })\r\n                    .call(() => resolve())\r\n                    .start();\r\n            });\r\n            \r\n            // 显示简单的加载信息\r\n            this.createLoadingText(`进入${this.getLevelTypeDisplayName(toLevel)}...`);\r\n            \r\n            // 短暂等待\r\n            await new Promise<void>((resolve) => {\r\n                setTimeout(resolve, 500);\r\n            });\r\n            \r\n            // 淡出黑色\r\n            await new Promise<void>((resolve) => {\r\n                tween(sprite)\r\n                    .to(0.3, { color: new Color(0, 0, 0, 0) })\r\n                    .call(() => {\r\n                        overlay.destroy();\r\n                        resolve();\r\n                    })\r\n                    .start();\r\n            });\r\n            \r\n            this.transitionContainer!.active = false;\r\n            \r\n        } finally {\r\n            this.isTransitioning = false;\r\n        }\r\n    }\r\n\r\n    // 章节切换特殊过场\r\n    public async chapterTransition(fromChapter: ChapterTheme, toChapter: ChapterTheme): Promise<void> {\r\n        if (this.isTransitioning) return;\r\n\r\n        console.log(`Chapter transition: ${fromChapter} -> ${toChapter}`);\r\n        \r\n        const fromTheme = this.chapterThemes.get(fromChapter);\r\n        const toTheme = this.chapterThemes.get(toChapter);\r\n        \r\n        if (!fromTheme || !toTheme) return;\r\n\r\n        this.isTransitioning = true;\r\n        \r\n        try {\r\n            this.transitionContainer!.active = true;\r\n            \r\n            // 创建章节过渡动画\r\n            await this.playChapterTransitionSequence(fromTheme, toTheme);\r\n            \r\n            this.transitionContainer!.active = false;\r\n            \r\n        } finally {\r\n            this.isTransitioning = false;\r\n        }\r\n    }\r\n\r\n    private async playChapterTransitionSequence(\r\n        fromTheme: ChapterTransitionTheme, \r\n        toTheme: ChapterTransitionTheme\r\n    ): Promise<void> {\r\n        // 第一阶段：展示前章节结束\r\n        await this.showChapterEnd(fromTheme);\r\n        \r\n        // 第二阶段：过渡动画\r\n        await this.playChapterBridgeAnimation();\r\n        \r\n        // 第三阶段：展示新章节开始\r\n        await this.showChapterBegin(toTheme);\r\n    }\r\n\r\n    private async showChapterEnd(theme: ChapterTransitionTheme): Promise<void> {\r\n        // 显示章节完成信息\r\n        const endNode = new Node('ChapterEnd');\r\n        endNode.setParent(this.contentLayer);\r\n        \r\n        const label = endNode.addComponent(Label);\r\n        label.string = `${theme.chapterTitle} - 完成`;\r\n        label.fontSize = 36;\r\n        label.color = theme.accentColor;\r\n        \r\n        return new Promise<void>((resolve) => {\r\n            tween(endNode)\r\n                .to(1.0, { scale: new Vec3(1.2, 1.2, 1) })\r\n                .to(1.0, { scale: new Vec3(0.8, 0.8, 1) })\r\n                .call(() => {\r\n                    endNode.destroy();\r\n                    resolve();\r\n                })\r\n                .start();\r\n        });\r\n    }\r\n\r\n    private async playChapterBridgeAnimation(): Promise<void> {\r\n        // 过渡动画：螺旋或漩涡效果\r\n        return new Promise<void>((resolve) => {\r\n            setTimeout(resolve, 1000);\r\n        });\r\n    }\r\n\r\n    private async showChapterBegin(theme: ChapterTransitionTheme): Promise<void> {\r\n        // 显示新章节开始信息\r\n        this.createChapterInfo(theme);\r\n        \r\n        return new Promise<void>((resolve) => {\r\n            setTimeout(resolve, 2000);\r\n        });\r\n    }\r\n\r\n    // 获取当前过场状态\r\n    public isCurrentlyTransitioning(): boolean {\r\n        return this.isTransitioning;\r\n    }\r\n\r\n    // 强制停止当前过场\r\n    public forceStopTransition(): void {\r\n        if (this.isTransitioning) {\r\n            this.isTransitioning = false;\r\n            this.transitionContainer!.active = false;\r\n            this.currentTransition = null;\r\n            console.log('Transition force stopped');\r\n        }\r\n    }\r\n}"]}